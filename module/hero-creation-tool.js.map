{"version":3,"file":"hero-creation-tool.js","sources":["../../src/module/constants.ts","../../src/module/CompendiumSourcesSubmenu.ts","../../src/module/settings.ts","../../src/module/preloadTemplates.ts","../../src/module/utils.ts","../../src/module/Step.ts","../../src/module/options/HeroOption.ts","../../src/module/options/InputOption.ts","../../src/module/tabs/basicsStep.ts","../../src/module/options/FixedOption.ts","../../src/module/indexUtils.ts","../../src/module/tabs/abilitiesStep.ts","../../src/module/options/SelectableOption.ts","../../src/module/options/DeletableOption.ts","../../src/module/options/MultiOption.ts","../../src/module/proficiencyUtils.ts","../../src/module/options/HiddenOption.ts","../../src/module/options/SearchableIndexEntryOption.ts","../../src/module/tabs/raceStep.ts","../../src/module/options/SelectableIndexEntryOption.ts","../../src/module/HitDie.ts","../../src/module/tabs/classStep.ts","../../src/module/options/SelectOrCustomItemOption.ts","../../src/module/tabs/backgroundStep.ts","../../src/module/options/OptionContainer.ts","../../src/module/options/QuantifiableOption.ts","../../src/module/tabs/equipmentStep.ts","../../src/module/tabs/spellsStep.ts","../../src/module/tabs/bioStep.ts","../../src/module/HeroCreationToolApp.ts","../../src/module/migrations/migration_1.ts","../../src/module/migrations/migrationsHandler.ts","../../src/module/hero-creation-tool.ts"],"sourcesContent":["// Class for general global variables.\n\nexport const MODULE_NAME = 'hero-creation-tool';\nexport const MODULE_PATH = 'modules/hero-creation-tool';\n\nexport const LOG_PREFIX = 'Hero Creation Tool';\nexport const MYSTERY_MAN = 'icons/svg/mystery-man.svg';\n\nexport const enum DEFAULT_PACKS {\n  RACES = 'dnd5e.races',\n  RACE_FEATURES = 'dnd5e.races',\n  CLASSES = 'dnd5e.classes',\n  CLASS_FEATURES = 'dnd5e.classfeatures',\n  ITEMS = 'dnd5e.items',\n  SPELLS = 'dnd5e.spells',\n  RULES = 'dnd5e.rules',\n}\n\nexport const INTEGRATION = {\n  TOKENIZER: {\n    VERSION: '3.3.0',\n  },\n};\n\nexport const MERGE_OPTIONS = {\n  insertKeys: true,\n  insertValues: true,\n  overwrite: true,\n  recursive: true,\n  inplace: false,\n};\n\nexport type HpCalculation = 'roll' | 'avg';\n","import * as Constants from './constants';\nimport SettingKeys from './settings';\n\nexport default class CompendiumSourcesSubmenu extends FormApplication {\n  constructor() {\n    super({});\n    this.baseCompendiumList = game.packs.filter((p) => p.documentName === 'Item');\n  }\n\n  baseCompendiumList: any;\n\n  static get defaultOptions() {\n    return mergeObject(super.defaultOptions, {\n      classes: ['form'],\n      popOut: true,\n      width: 400,\n      height: 400,\n      template: `/modules/hero-creation-tool/templates/sources-submenu.html`,\n      id: 'hct-settings-submenu',\n      title: 'Hero Creation Tool - Sources',\n      resizable: false,\n    });\n  }\n\n  activateListeners(html: JQuery) {\n    super.activateListeners(html);\n\n    const coll = $('.hct-collapsible', html);\n    let i;\n\n    for (i = 0; i < coll.length; i++) {\n      coll[i].addEventListener('click', function () {\n        this.classList.toggle('active');\n        const child = this.firstElementChild;\n        const content = this.nextElementSibling as any;\n        if (content.style.display === 'block') {\n          content.style.display = 'none';\n          child?.classList.remove('fa-chevron-down');\n          child?.classList.add('fa-chevron-right');\n        } else {\n          content.style.display = 'block';\n          child?.classList.remove('fa-chevron-right');\n          child?.classList.add('fa-chevron-down');\n        }\n      });\n    }\n  }\n\n  getData() {\n    let selected: any = game.settings.get(Constants.MODULE_NAME, SettingKeys.SOURCES);\n    if (foundry.utils.isObjectEmpty(selected)) {\n      selected = {\n        races: [Constants.DEFAULT_PACKS.RACES],\n        racialFeatures: [Constants.DEFAULT_PACKS.RACE_FEATURES],\n        classes: [Constants.DEFAULT_PACKS.CLASSES],\n        classFeatures: [Constants.DEFAULT_PACKS.CLASS_FEATURES],\n        backgroundFeatures: [],\n        spells: [Constants.DEFAULT_PACKS.SPELLS],\n        feats: [],\n      };\n    }\n    const data = buildTemplateData({\n      compendiaList: this.baseCompendiumList,\n      selectedCompendia: selected,\n    });\n    return data as any;\n  }\n\n  _updateObject(event: Event, formData?: any) {\n    console.log(`${Constants.LOG_PREFIX} | Saving compendia sources:`);\n    console.log(formData);\n    return game.settings.set(Constants.MODULE_NAME, SettingKeys.SOURCES, formData);\n  }\n}\n\nfunction buildCompendiaList(compendiaList: any[], defaultCollection?: string[]) {\n  return compendiaList.map((p: any) => {\n    return {\n      collection: p.collection as string,\n      label: `${p.metadata.label} [${p.metadata.package}]`,\n      checked: defaultCollection?.includes(p.collection),\n    };\n  });\n}\n\ntype BuildData = {\n  compendiaList: any[];\n  selectedCompendia: {\n    races: string[];\n    racialFeatures: string[];\n    classes: string[];\n    classFeatures: string[];\n    backgroundFeatures: string[];\n    spells: string[];\n    feats: string[];\n  };\n};\nfunction buildTemplateData({ compendiaList, selectedCompendia }: BuildData) {\n  return {\n    source: {\n      races: {\n        label: game.i18n.localize('HCT.Setting.Sources.RaceCompendia'),\n        compendia: buildCompendiaList(compendiaList, selectedCompendia.races),\n      },\n      racialFeatures: {\n        label: game.i18n.localize('HCT.Setting.Sources.RacialFeatureCompendia'),\n        compendia: buildCompendiaList(compendiaList, selectedCompendia.racialFeatures),\n      },\n      classes: {\n        label: game.i18n.localize('HCT.Setting.Sources.ClassCompendia'),\n        compendia: buildCompendiaList(compendiaList, selectedCompendia.classes),\n      },\n      classFeatures: {\n        label: game.i18n.localize('HCT.Setting.Sources.ClassFeatureCompendia'),\n        compendia: buildCompendiaList(compendiaList, selectedCompendia.classFeatures),\n      },\n      backgroundFeatures: {\n        label: game.i18n.localize('HCT.Setting.Sources.BackgroundFeatureCompendia'),\n        compendia: buildCompendiaList(compendiaList, selectedCompendia.backgroundFeatures),\n      },\n      spells: {\n        label: game.i18n.localize('HCT.Setting.Sources.SpellCompendia'),\n        compendia: buildCompendiaList(compendiaList, selectedCompendia.spells),\n      },\n      feats: {\n        label: game.i18n.localize('HCT.Setting.Sources.FeatCompendia'),\n        compendia: buildCompendiaList(compendiaList, selectedCompendia.feats),\n      },\n    },\n  };\n}\n","import CompendiumSourcesSubmenu from './CompendiumSourcesSubmenu';\nimport * as Constants from './constants';\n\n// settings not shown on the Module Settings - not modifiable by users\nexport const enum PrivateSettingKeys {\n  LAST_MIGRATION = 'lastMigration',\n}\n\nconst enum SettingKeys {\n  USE_TOKENIZER = 'useTokenizer',\n  TOKEN_BAR = 'displayBarsMode',\n  TOKEN_NAME = 'displayNameMode',\n  SHOW_ROLLS_AS_MESSAGES = 'showRolls',\n  ENABLE_ASI_ROLL = 'enableAbilityScoreRolls',\n  ENABLE_ASI_POINTBUY = 'enableAbilityScorePointBuy',\n  ENABLE_ASI_STANDARD = 'enableAbilityScoreStandardArray',\n  ENABLE_ASI_MANUAL = 'enableAbilityScoreManualInput',\n  INDIVIDUAL_PANEL_SCROLLS = 'individualScrolls',\n  DEFAULT_GOLD_DICE = 'defaultGoldDice',\n  FIGHTING_STYLE_STRING = 'fightingStyleLookupString',\n  EQUIPMENTS_BLACKLIST = 'equipmentsBlackList',\n  SUBRACES_BLACKLIST = 'subracesBlacklist',\n  BUTTON_ON_DIALOG = 'buttonOnDialog',\n  POINT_BUY_LIMIT = 'pointBuyLimit',\n  ABILITY_ROLL_FORMULA = 'abiiltyRollFormula',\n  SOURCES = 'compendiumSources',\n}\nexport default SettingKeys;\n\nexport const enum SourceType {\n  RACES = 'races',\n  RACIAL_FEATURES = 'racialFeatures',\n  CLASSES = 'classes',\n  CLASS_FEATURES = 'classFeatures',\n  BACKGROUND_FEATURES = 'backgroundFeatures',\n  SPELLS = 'spells',\n  FEATS = 'feats',\n}\n\nexport type Source = {\n  [key in SourceType]: any;\n};\n\nexport function registerSettings(): void {\n  console.log(`${Constants.LOG_PREFIX} | Building module settings`);\n\n  Handlebars.registerHelper('checkedIf', function (condition) {\n    return condition ? 'checked' : '';\n  });\n\n  defaultStartingGoldDice();\n  showRollsAsChatMessages();\n  individualPanelScrolls();\n  abilityScoreMethods();\n  pointBuyLimit();\n  abilityRollFormula();\n  tokenDisplayNameMode();\n  tokenDisplayBarsMode();\n  fightingStyleLookupString();\n  equipmentBlacklist();\n  subraceNameBlacklist();\n  buttonOnDialogInsteadOfActorsDirectory();\n  // custom packs\n  sourcesConfiguration();\n  // integrations\n  useTokenizerIfAvailable();\n  // private settings\n  lastMigration();\n}\n\nfunction sourcesConfiguration() {\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.SOURCES, {\n    scope: 'world',\n    config: false,\n    type: Object,\n    default: {\n      races: [Constants.DEFAULT_PACKS.RACES],\n      racialFeatures: [Constants.DEFAULT_PACKS.RACE_FEATURES],\n      classes: [Constants.DEFAULT_PACKS.CLASSES],\n      classFeatures: [Constants.DEFAULT_PACKS.CLASS_FEATURES],\n      backgroundFeatures: [],\n      spells: [Constants.DEFAULT_PACKS.SPELLS],\n      feats: [],\n    },\n  });\n  // Define a settings submenu which handles advanced configuration needs\n  game.settings.registerMenu(Constants.MODULE_NAME, SettingKeys.SOURCES, {\n    name: game.i18n.localize('HCT.Setting.Sources.Name'),\n    hint: game.i18n.localize('HCT.Setting.Sources.Hint'),\n    label: game.i18n.localize('HCT.Setting.Sources.Label'),\n    icon: 'fas fa-atlas',\n    type: CompendiumSourcesSubmenu,\n    restricted: true,\n  });\n}\n\nfunction fightingStyleLookupString() {\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.FIGHTING_STYLE_STRING, {\n    name: game.i18n.localize('HCT.Setting.FightingStyleString.Name'),\n    hint: game.i18n.localize('HCT.Setting.FightingStyleString.Hint'),\n    scope: 'world',\n    config: true,\n    default: 'Fighting Style',\n    type: String,\n  });\n}\n\nfunction equipmentBlacklist() {\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.EQUIPMENTS_BLACKLIST, {\n    name: game.i18n.localize('HCT.Setting.EquipmentBlacklist.Name'),\n    hint: game.i18n.localize('HCT.Setting.EquipmentBlacklist.Hint'),\n    scope: 'world',\n    config: true,\n    default:\n      'Potion of Climbing; Potion of Healing; Spell Scroll 1st Level; Spell Scroll Cantrip Level; Unarmed Strike',\n    type: String,\n  });\n}\n\nfunction subraceNameBlacklist() {\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.SUBRACES_BLACKLIST, {\n    name: game.i18n.localize('HCT.Setting.SubraceNameBlacklist.Name'),\n    hint: game.i18n.localize('HCT.Setting.SubraceNameBlacklist.Hint'),\n    scope: 'world',\n    config: true,\n    default: 'Gnome Cunning; Halfling Nimbleness',\n    type: String,\n  });\n}\n\nfunction defaultStartingGoldDice() {\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.DEFAULT_GOLD_DICE, {\n    name: game.i18n.localize('HCT.Setting.DefaultGoldDice.Name'),\n    hint: game.i18n.localize('HCT.Setting.DefaultGoldDice.Hint'),\n    scope: 'world',\n    config: true,\n    default: '5d4 * 10',\n    type: String,\n  });\n}\n\nfunction useTokenizerIfAvailable() {\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.USE_TOKENIZER, {\n    name: game.i18n.localize('HCT.Setting.UseTokenizer.Name'),\n    hint: game.i18n.localize('HCT.Setting.UseTokenizer.Hint'),\n    scope: 'world',\n    config: true,\n    type: Boolean,\n    default: false,\n  });\n}\n\nfunction buttonOnDialogInsteadOfActorsDirectory() {\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.BUTTON_ON_DIALOG, {\n    name: game.i18n.localize('HCT.Setting.ButtonOnDialogInsteadOfActorsDirectory.Name'),\n    hint: game.i18n.localize('HCT.Setting.ButtonOnDialogInsteadOfActorsDirectory.Hint'),\n    scope: 'world',\n    config: true,\n    type: Boolean,\n    default: false,\n  });\n}\n\nfunction tokenDisplayBarsMode() {\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.TOKEN_BAR, {\n    name: game.i18n.localize('HCT.Setting.TokenBarMode.Name'),\n    scope: 'world',\n    config: true,\n    type: Number,\n    choices: {\n      0: 'Never Displayed',\n      10: 'When Controlled',\n      20: 'Hover by Owner',\n      30: 'Hover by Anyone',\n      40: 'Always for Owner',\n      50: 'Always for Anyone',\n    },\n    default: 20,\n  });\n}\n\nfunction tokenDisplayNameMode() {\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.TOKEN_NAME, {\n    name: game.i18n.localize('HCT.Setting.TokenNameMode.Name'),\n    scope: 'world',\n    config: true,\n    type: Number,\n    choices: {\n      0: 'Never Displayed',\n      10: 'When Controlled',\n      20: 'Hover by Owner',\n      30: 'Hover by Anyone',\n      40: 'Always for Owner',\n      50: 'Always for Anyone',\n    },\n    default: 20,\n  });\n}\n\nfunction showRollsAsChatMessages() {\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.SHOW_ROLLS_AS_MESSAGES, {\n    name: game.i18n.localize('HCT.Setting.ShowRolls.Name'),\n    hint: game.i18n.localize('HCT.Setting.ShowRolls.Hint'),\n    scope: 'world',\n    config: true,\n    type: Boolean,\n    default: true,\n  });\n}\n\nfunction individualPanelScrolls() {\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.INDIVIDUAL_PANEL_SCROLLS, {\n    name: game.i18n.localize('HCT.Setting.IndividualPanelScroll.Name'),\n    hint: game.i18n.localize('HCT.Setting.IndividualPanelScroll.Hint'),\n    scope: 'client',\n    config: true,\n    type: Boolean,\n    default: false,\n  });\n}\n\nfunction abilityScoreMethods() {\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.ENABLE_ASI_ROLL, {\n    name: game.i18n.localize('HCT.Setting.AllowAbilityRolling.Name'),\n    scope: 'world',\n    config: true,\n    type: Boolean,\n    default: true,\n  });\n\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.ENABLE_ASI_STANDARD, {\n    name: game.i18n.localize('HCT.Setting.AllowAbilityStandardArray.Name'),\n    scope: 'world',\n    config: true,\n    type: Boolean,\n    default: true,\n  });\n\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.ENABLE_ASI_MANUAL, {\n    name: game.i18n.localize('HCT.Setting.AllowAbilityInput.Name'),\n    scope: 'world',\n    config: true,\n    type: Boolean,\n    default: true,\n  });\n\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.ENABLE_ASI_POINTBUY, {\n    name: game.i18n.localize('HCT.Setting.AllowAbilityPointBuy.Name'),\n    scope: 'world',\n    config: true,\n    type: Boolean,\n    default: true,\n  });\n}\n\nfunction pointBuyLimit() {\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.POINT_BUY_LIMIT, {\n    name: game.i18n.localize('HCT.Setting.PointBuyLimit.Name'),\n    scope: 'world',\n    config: true,\n    default: 27,\n    type: Number,\n  });\n}\n\nfunction abilityRollFormula() {\n  game.settings.register(Constants.MODULE_NAME, SettingKeys.ABILITY_ROLL_FORMULA, {\n    name: game.i18n.localize('HCT.Setting.AbilityRollFormula.Name'),\n    scope: 'world',\n    config: true,\n    default: '4d6kh3',\n    type: String,\n  });\n}\n\n// PRIVATE SETTINGS\n\nfunction lastMigration() {\n  game.settings.register(Constants.MODULE_NAME, PrivateSettingKeys.LAST_MIGRATION, {\n    scope: 'world',\n    config: false,\n    default: 0,\n    type: Number,\n  });\n}\n","import * as Constants from './constants';\n\nexport async function preloadTemplates(): Promise<Handlebars.TemplateDelegate[]> {\n  console.log(`${Constants.LOG_PREFIX} | Loading templates`);\n\n  const templatePaths: string[] = [\n    Constants.MODULE_PATH + '/templates/nav-tabs.html',\n    Constants.MODULE_PATH + '/templates/nav-buttons.html',\n    Constants.MODULE_PATH + '/templates/tabs/abilities.html',\n    Constants.MODULE_PATH + '/templates/tabs/background.html',\n    Constants.MODULE_PATH + '/templates/tabs/basics.html',\n    Constants.MODULE_PATH + '/templates/tabs/bio.html',\n    Constants.MODULE_PATH + '/templates/tabs/class.html',\n    Constants.MODULE_PATH + '/templates/tabs/equipment.html',\n    Constants.MODULE_PATH + '/templates/tabs/race.html',\n    Constants.MODULE_PATH + '/templates/tabs/spells.html',\n    Constants.MODULE_PATH + '/templates/tabs/start.html',\n  ];\n\n  return loadTemplates(templatePaths);\n}\n","import * as Constants from './constants';\nimport HeroCreationTool from './HeroCreationToolApp';\nimport SettingKeys, { PrivateSettingKeys } from './settings';\n\nexport function setPanelScrolls($section: JQuery) {\n  const individualScrolls = getModuleSetting(SettingKeys.INDIVIDUAL_PANEL_SCROLLS);\n  const scroll = 'hct-y-scroll';\n  const height = 'hct-height-100p';\n\n  const $leftPanel = $('.hct-panel-left', $section);\n  const $rightPanel = $('.hct-panel-right', $section);\n  const $panelContainer = $('.hct-panel-container', $section);\n\n  if (individualScrolls) {\n    $leftPanel.addClass(scroll);\n    $rightPanel.addClass(scroll);\n    $panelContainer.addClass(height);\n    $section.removeClass(scroll);\n  } else {\n    $leftPanel.removeClass(scroll);\n    $rightPanel.removeClass(scroll);\n    $panelContainer.removeClass(height);\n    $section.addClass(scroll);\n  }\n}\n\nexport function getModuleSetting(key: SettingKeys | PrivateSettingKeys) {\n  return game.settings.get(Constants.MODULE_NAME, key);\n}\n\nexport function getAbilityModifierValue(value: number) {\n  return Math.floor((value - 10) / 2);\n}\n\nexport function filterItemList<T>({\n  filterValues,\n  filterField,\n  itemList,\n}: {\n  filterValues: string[];\n  filterField: string;\n  itemList: T[];\n}): T[] {\n  if (!itemList) return [];\n  const filtered = itemList.filter((item: any) => {\n    const req: string = getProperty(item, filterField);\n    let reqs: string[];\n    if (req.indexOf(',') > -1) {\n      // feature applies for multiple classes / races / levels\n      reqs = req.split(',').map((r) => r.trim());\n    } else {\n      reqs = [req];\n    }\n    return reqs.some((r) => filterValues.includes(r) && !filterValues.includes(item.name));\n  });\n  return filtered;\n}\n\nexport function addActorDirectoryButton(app: HeroCreationTool) {\n  console.log(`${Constants.LOG_PREFIX} | Adding actors directory button`);\n\n  $('.directory-header', $('[data-tab=\"actors\"]'))\n    .filter((i, e) => !$(e).has('.header-hct-button').length)\n    .prepend(\n      `<button class='header-hct-button' data-hct_start><i class='fas fa-dice-d20'></i>${game.i18n.localize(\n        'HCT.ActorsDirectoryButton',\n      )}</button>`,\n    );\n  $('[data-hct_start]').on('click', function () {\n    if (userHasRightPermissions()) app.openForNewActor();\n  });\n}\n\nexport function addCreateNewActorButton(app: HeroCreationTool, html: any, dialogApp: any) {\n  console.log(`${Constants.LOG_PREFIX} | Adding Create New Actor button`);\n\n  const $hctButton = $(\n    `<button class='dialog-button' data-hct_start>\n      <i class='fas fa-dice-d20'></i>${game.i18n.localize('HCT.ActorsDirectoryButton')}\n    </button>`,\n  );\n\n  $('button', html).after($hctButton); // added after the Create New Actor confirm button\n  $hctButton.on('click', function () {\n    if (userHasRightPermissions()) {\n      const heroName = $('input', html).val() as string;\n      app.openForNewActor(heroName);\n    }\n    dialogApp.close();\n  });\n}\n\nfunction userHasRightPermissions(): boolean {\n  const userRole = (game as any).user.role;\n\n  // create actor (REQUIRED)\n  if (!((game as any).permissions.ACTOR_CREATE as Array<number>).includes(userRole)) {\n    ui.notifications?.error(game.i18n.localize('HCT.Permissions.NeedCreateActorError'));\n    return false;\n  }\n\n  // create item (optional)\n  if (!((game as any).permissions.ITEM_CREATE as Array<number>).includes(userRole)) {\n    ui.notifications?.warn(game.i18n.localize('HCT.Permissions.NeedCreateItemWarn'));\n  }\n\n  // upload files (optional)\n  if (!((game as any).permissions.FILES_UPLOAD as Array<number>).includes(userRole)) {\n    ui.notifications?.warn(game.i18n.localize('HCT.Permissions.NeedFileUploadWarn'));\n  }\n\n  // browse files (optional)\n  if (!((game as any).permissions.FILES_BROWSE as Array<number>).includes(userRole)) {\n    ui.notifications?.warn(game.i18n.localize('HCT.Permissions.NeedFileBrowseWarn'));\n  }\n  return true;\n}\n","import HeroOption from './options/HeroOption';\n\nexport abstract class Step {\n  readonly step: StepEnum;\n  protected readonly stepOptions: HeroOption[];\n\n  constructor(step: StepEnum) {\n    this.step = step;\n    this.stepOptions = [];\n  }\n\n  /**\n   * Delegation method for this tab to set its own listeners when Application.activateListeners()\n   * is called. Here all HTML event listeners should be registered.\n   */\n  setListeners(): void {\n    return;\n  }\n\n  /**\n   * Method called by the Application for each tab to provide any specific\n   * data this tab might need. Called during the **first** 'renderApp' Hook.\n   *\n   * Might not be needed for every tab.\n   */\n  setSourceData(): void {\n    return;\n  }\n\n  /**\n   * Method called by the Application for each tab to render their internal HTML.\n   * Called at the end of every 'renderApp' Hook.\n   */\n  renderData(data?: any): void {\n    return;\n  }\n\n  /**\n   * Method called by the Application when on final submit,\n   * for every tab to return their options.\n   *\n   * Some options might be defined before, this method been the last chance to created\n   * HeroOptions derived from data, for example on the Abilities tab.\n   *\n   * By default returns stepOptions, but should be overloaded as needed.\n   */\n  getOptions(): HeroOption[] {\n    return this.stepOptions;\n  }\n\n  /**\n   * Method called when another tab needs data from this one, to abstract the internal complexities\n   */\n  getUpdateData(): any {\n    throw Error('getUpdateData() not implemented in step ' + this.constructor.name);\n  }\n\n  /**\n   * Method called when switching to this tab, useful when trying to update this tab's content based on external data\n   * e.g. Updating Spells' spellcasting ability based on Class\n   */\n  update(data?: any): void {\n    throw Error('update() not implemented in step ' + this.constructor.name);\n  }\n\n  clearOptions(): void {\n    this.stepOptions.splice(0, this.stepOptions.length);\n  }\n\n  /**\n   * Helper method that returns the JQuery element representing this tab's entire section.\n   */\n  abstract section(): JQuery;\n}\n\nexport enum StepEnum {\n  Basics = 'basics',\n  Race = 'race',\n  Class = 'class',\n  Abilities = 'abilities',\n  Background = 'background',\n  Equipment = 'equipment',\n  Spells = 'spells',\n  Biography = 'bio',\n}\n","import { StepEnum } from '../Step';\nimport type { ActorDataConstructorData } from '@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs/actorData';\n\n/**\n * Represents an option that will be reflected on the final hero.\n * @interface\n */\nexport default interface HeroOption {\n  render(parent: JQuery): void;\n  value(): any;\n  isFulfilled(): boolean;\n  applyToHero(actor: ActorDataConstructorData): void;\n  key: string;\n  origin: StepEnum;\n  settings: {\n    addValues: boolean;\n  };\n}\n\nexport const apply = (\n  existingData: ActorDataConstructorData,\n  key: string,\n  value: any,\n  addValues: boolean,\n  enforceNumber?: boolean,\n) => {\n  try {\n    [key, value] = getActorDataForProficiency(key, value);\n    if (\n      !key ||\n      !value ||\n      key.indexOf('null') > -1 ||\n      (!Array.isArray(value) && isNaN(value) && typeof value == 'string' && value.indexOf('null') > -1)\n    )\n      return existingData;\n\n    const dataSnapshot: any = {};\n    if (addValues) {\n      // find any previous value on existing data\n      dataSnapshot[key] = getProperty(existingData, key); //getValueFromInnerProperty(existingData, key);\n      if (dataSnapshot[key]) {\n        if (Array.isArray(dataSnapshot[key])) {\n          value = dataSnapshot[key].concat(...value);\n        } else {\n          if (!isNaN(value)) {\n            value = Number.parseInt(dataSnapshot[key]) + Number.parseInt(value);\n          } else {\n            console.error('Expected to add value to previous, but value is not a number nor array');\n          }\n        }\n      }\n    }\n    dataSnapshot[key] = enforceNumber ? Number.parseInt(value) : value;\n    mergeObject(existingData, dataSnapshot);\n  } catch (error) {\n    console.warn('Error on HeroOption.apply(..) - printing error and logging variables');\n    console.error(error);\n    console.warn('existingData: ');\n    console.warn(existingData);\n    console.warn(`key: [${key}]`);\n    console.warn('value: ');\n    console.warn(value);\n    console.warn(`addValues: [${addValues}]`);\n  }\n};\n\nfunction getActorDataForProficiency(key: string, value: any): [key: string, value: any] {\n  if (!isProficiencyKey(key)) return [key, value];\n\n  if (Array.isArray(value) && value.length == 1) {\n    value = value[0];\n  }\n  const baseKey = 'data.traits';\n  let pair: [string, any];\n  if (key === 'skills') {\n    pair = [`data.skills.${value}.value`, 1];\n  } else {\n    if (isCustomKey(key, value)) pair = [`${baseKey}.${key}.custom`, value];\n    else pair = [`${baseKey}.${key}.value`, [value]];\n  }\n  return pair;\n}\n\nfunction isProficiencyKey(key: string): boolean {\n  if (key.indexOf('skill') > -1) return true;\n  if (key.indexOf('language') > -1) return true;\n  if (key.indexOf('weapon') > -1) return true;\n  if (key.indexOf('armor') > -1) return true;\n  if (key.indexOf('tool') > -1) return true;\n  return false;\n}\n\nfunction isCustomKey(key: string, value: string): boolean {\n  const dnd5e = (game as any).dnd5e;\n  let keyList!: string[];\n  switch (key) {\n    case 'weaponProf':\n      keyList = [...Object.keys(dnd5e.config.weaponProficiencies), ...Object.keys(dnd5e.config.weaponIds)];\n      break;\n    case 'armorProf':\n      keyList = [...Object.keys(dnd5e.config.armorProficiencies), ...Object.keys(dnd5e.config.armorIds)];\n      break;\n    case 'toolProf':\n      keyList = [...Object.keys(dnd5e.config.toolProficiencies), ...Object.keys(dnd5e.config.toolIds)];\n      break;\n    case 'languages':\n      keyList = Object.keys(dnd5e.config.languages);\n      break;\n  }\n  for (const key in keyList) {\n    if (keyList[key] === value) return false;\n  }\n  return true;\n}\n","import { StepEnum } from '../Step';\nimport { ActorDataConstructorData } from '@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs/actorData';\nimport HeroOption, { apply } from './HeroOption';\n\n/**\n * Represents a manually inputed value by the player for the created actor.\n * Expected to be a String, but should be reasonably easy to use it for numbers or expand it for that use.\n * e.g. Hero name\n * @class\n */\nexport default class InputOption implements HeroOption {\n  constructor(\n    readonly origin: StepEnum,\n    readonly key: string,\n    private placeholder: string,\n    private val: string | number,\n    readonly settings: {\n      addValues: boolean;\n      type: 'text' | 'number';\n      min?: number;\n      max?: number;\n      preLabel?: string;\n      postLabel?: string;\n      class?: string;\n      data?: string;\n    } = { addValues: false, type: 'text' },\n  ) {}\n\n  $elem!: JQuery;\n\n  render($parent: JQuery<HTMLElement>, settings?: { beforeParent: boolean }): void {\n    const $container = $('<div class=\"hct-option\">');\n    const min = this.settings.min ? `min=\"${this.settings.min}\"` : '';\n    const max = this.settings.max ? `max=\"${this.settings.max}\"` : '';\n    const wrapped = !!this.settings.postLabel;\n\n    if (this.settings.preLabel) {\n      const $preLabel = $(`<span class=\"hct-option-label\">${this.settings.preLabel}</span>`);\n      $container.append($preLabel);\n    }\n\n    const data = this.settings.data;\n    if (wrapped) {\n      const $wrapper = $(`<div class=\"hct-flex ${this.settings.class ?? ''}\">`);\n      this.$elem = $(`<input type=\"${this.settings.type}\" placeholder=\"${this.placeholder}\" ${data ?? ''} \n        value=${this.val} ${this.settings.type == 'number' ? `${min} ${max}` : ''}>`);\n      $wrapper.append(this.$elem);\n\n      if (this.settings.postLabel) {\n        const $postLabel = $(`<p class='hct-postlabel'>${this.settings.postLabel}</p>`);\n        $wrapper.append($postLabel);\n      }\n      $container.append($wrapper);\n    } else {\n      this.$elem = $(`<input class=\"${this.settings.class ?? ''}\"\n        type=\"${this.settings.type}\" placeholder=\"${this.placeholder}\"  ${data ?? ''}  \n        value=${this.val} ${this.settings.type == 'number' ? `${min} ${max}` : ''}>`);\n      $container.append(this.$elem);\n    }\n\n    if (settings?.beforeParent) {\n      $parent.before($container);\n    } else {\n      $parent.append($container);\n    }\n  }\n\n  value(): string | number {\n    const val = this.$elem.val();\n    if (this.settings.type == 'number') return val as number;\n    return val as string;\n  }\n\n  isFulfilled(): boolean {\n    return !!this.$elem.val();\n  }\n\n  applyToHero(actor: ActorDataConstructorData) {\n    apply(actor, this.key, this.value(), this.settings.addValues, this.settings.type === 'number');\n  }\n}\n","/*\n  Functions used exclusively on the Basics tab\n*/\nimport * as Constants from '../constants';\nimport { Step, StepEnum } from '../Step';\nimport InputOption from '../options/InputOption';\nimport SettingKeys from '../settings';\n\nconst enum ImgType {\n  AVATAR = 'avatar',\n  TOKEN = 'token',\n}\n\ntype TokenizerResponse = {\n  avatarFilename: string;\n  tokenFilename: string;\n};\n\nclass _Basics extends Step {\n  constructor() {\n    super(StepEnum.Basics);\n  }\n\n  section = () => $('#basicsDiv');\n\n  avatarOption!: InputOption;\n  tokenOption!: InputOption;\n  nameOption!: InputOption;\n\n  useTokenizer!: boolean;\n\n  fileChangedCallback(type: ImgType, path: string): void {\n    const $input = type === ImgType.AVATAR ? this.avatarOption.$elem : this.tokenOption.$elem;\n    const $img = $(`[data-img=${type}]`);\n\n    $input.val(path);\n    $img.attr('src', path);\n  }\n\n  setListeners(): void {\n    $('[data-filepick]', this.section()).on('click', (event) => {\n      const pick = $(event.target).data('filepick');\n\n      if (this.useTokenizer && !event.shiftKey) {\n        const module = game.modules.get('vtta-tokenizer');\n\n        if (!module) {\n          ui.notifications?.warn(game.i18n.localize('HCT.Integration.Tokenizer.Error.ModuleNotFound'));\n          this.openFilePicker(pick);\n          return;\n        }\n        if (!module.active) {\n          ui.notifications?.warn(game.i18n.localize('HCT.Integration.Tokenizer.Error.ModuleInactive'));\n          this.openFilePicker(pick);\n          return;\n        }\n        const tokenizerVersion = module?.data.version;\n        if (!tokenizerVersion) {\n          ui.notifications?.error(game.i18n.localize('HCT.Integration.Tokenizer.Error.VersionUnobtainable'));\n          this.openFilePicker(pick);\n          return;\n        }\n        const lastUnsupportedVersion = Constants.INTEGRATION.TOKENIZER.VERSION;\n        // search for newer than last unsupported version\n        if (!isNewerVersion(tokenizerVersion, lastUnsupportedVersion)) {\n          ui.notifications?.error(\n            game.i18n.format('HCT.Integration.Tokenizer.Error.VersionIncompatible', {\n              version: lastUnsupportedVersion,\n            }),\n          );\n          this.openFilePicker(pick);\n          return;\n        }\n        if (!this.nameOption.value()) {\n          ui.notifications?.error(game.i18n.localize('HCT.Integration.Tokenizer.NeedActorName'));\n          return;\n        }\n        const tokenizerOptions = {\n          name: this.nameOption.value(),\n          type: 'pc',\n          avatarFilename: this.avatarOption.value(),\n          tokenFilename: this.tokenOption.value(),\n        };\n        (window as any).Tokenizer.launch(tokenizerOptions, (response: TokenizerResponse) => {\n          this.fileChangedCallback(ImgType.AVATAR, response.avatarFilename);\n          this.fileChangedCallback(ImgType.TOKEN, response.tokenFilename);\n        });\n        return;\n      }\n      this.openFilePicker(pick);\n    });\n  }\n\n  setSourceData(): void {\n    this.useTokenizer = game.settings.get(Constants.MODULE_NAME, SettingKeys.USE_TOKENIZER) as boolean;\n  }\n\n  renderData(data: { actorName?: string }): void {\n    this.clearOptions();\n    this.nameOption = new InputOption(\n      this.step,\n      'name',\n      game.i18n.localize('HCT.Common.RequiredName'),\n      data?.actorName ?? '',\n    );\n    this.nameOption.render($('[data-hero_name]', this.section()));\n\n    this.avatarOption = new InputOption(this.step, 'img', Constants.MYSTERY_MAN, Constants.MYSTERY_MAN);\n    this.avatarOption.render($('[data-hero_avatar]', this.section()));\n\n    this.tokenOption = new InputOption(this.step, 'token.img', Constants.MYSTERY_MAN, Constants.MYSTERY_MAN);\n    this.tokenOption.render($('[data-hero_token]', this.section()));\n\n    this.stepOptions.push(this.nameOption, this.avatarOption, this.tokenOption);\n\n    $('[data-tokenizer-warning]').toggle(this.useTokenizer);\n  }\n\n  openFilePicker(input: string) {\n    const path1 = '/';\n    const type: ImgType = input === 'avatar' ? ImgType.AVATAR : ImgType.TOKEN;\n    const fp2 = new FilePicker({\n      type: 'image',\n      current: path1,\n      callback: (path: string) => this.fileChangedCallback(type, path),\n    } as any);\n    fp2.browse();\n  }\n}\nconst BasicsTab: Step = new _Basics();\nexport default BasicsTab;\n","import { StepEnum } from '../Step';\nimport { ActorDataConstructorData } from '@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs/actorData';\nimport HeroOption, { apply } from './HeroOption';\nimport { IndexEntry } from '../indexUtils';\n\n/**\n * Represents a fixed value that will be imprinted into the created actor\n * (e.g. how all Elves get Perception proficiency)\n * @class\n */\nexport default class FixedOption implements HeroOption {\n  constructor(\n    readonly origin: StepEnum,\n    readonly key: string,\n    private option: string | number | IndexEntry | { cp: number; sp: number; gp: number },\n    private textToShow?: string,\n    readonly settings: {\n      addValues: boolean;\n      type: OptionType;\n    } = { addValues: false, type: OptionType.TEXT },\n  ) {}\n\n  isFulfilled() {\n    return !!this.option;\n  }\n\n  applyToHero(actor: ActorDataConstructorData) {\n    apply(\n      actor,\n      this.key,\n      this.settings.type === OptionType.TEXT || this.settings.type === OptionType.CURRENCY\n        ? this.value()\n        : this.settings.type === OptionType.NUMBER\n        ? (this.value() as number)\n        : [this.value()],\n      this.settings.addValues,\n      this.settings.type === OptionType.NUMBER,\n    );\n  }\n\n  private $textElem = $('<p class=\"hct-option\">').html(`${this.textToShow}`);\n  private $itemImg = $('<img class=\"hct-icon hct-hover-shadow-accent\">');\n  private $itemName = $('<p>');\n\n  /**\n   * Builds the HTML element for this option and appends it to the parent\n   * @param {JQuery} parent\n   */\n  render(parent: JQuery): void {\n    if (this.settings.type === OptionType.TEXT) {\n      parent.append(this.$textElem);\n    } else {\n      const $container = $('<div class=\"hct-icon-with-context\">');\n      const item = this.option as IndexEntry;\n      const $link = $(\n        `<a class=\"content-link hct-icon-link\" draggable=\"false\" data-pack=\"${item._pack}\" data-id=\"${item._id}\">`,\n      );\n      this.$itemImg.attr('src', item.img);\n      $link.append(this.$itemImg);\n      this.$itemName.html(this.textToShow ?? (item.name as string));\n      $container.append($link);\n      $container.append(this.$itemName);\n      parent.append($container);\n    }\n  }\n\n  /**\n   * @returns the current value of this option\n   */\n  value(): any {\n    return this.option;\n  }\n}\n\nexport enum OptionType {\n  TEXT,\n  ITEM,\n  NUMBER,\n  CURRENCY,\n}\n","import * as CONSTANTS from './constants';\nimport SettingKeys, { Source, SourceType } from './settings';\n\nexport async function buildSourceIndexes() {\n  console.log(`${CONSTANTS.LOG_PREFIX} | Indexing source compendiums`);\n  const sourcePacks: Source = (await game.settings.get(CONSTANTS.MODULE_NAME, SettingKeys.SOURCES)) as Source;\n  const itemsPromises: Promise<Item | null | undefined>[] = [];\n  game.packs\n    .filter((p) => p.documentName == 'Item')\n    .forEach((p) => {\n      const name = p.collection;\n      const fieldsToIndex = new Set<string>();\n\n      // name added by default on all when indexed\n      addRaceFields(fieldsToIndex, sourcePacks, name);\n      addRacialFeaturesFields(fieldsToIndex, sourcePacks, name);\n      addClassFields(fieldsToIndex, sourcePacks, name);\n      addClassFeaturesFields(fieldsToIndex, sourcePacks, name);\n      addSpellFields(fieldsToIndex, sourcePacks, name);\n      addFeatFields(fieldsToIndex, sourcePacks, name);\n      addBackgroundFeaturesFields(fieldsToIndex, sourcePacks, name);\n\n      if (fieldsToIndex.size) {\n        fieldsToIndex.add('img');\n        itemsPromises.push((p as any).getIndex({ fields: [...fieldsToIndex] }));\n      }\n    });\n  await Promise.all(itemsPromises);\n}\n\nexport async function buildEquipmentAndJournalIndexes() {\n  console.log(`${CONSTANTS.LOG_PREFIX} | Indexing items (equipment) and journals (rules)`);\n  const itemsPack = game.packs.get(CONSTANTS.DEFAULT_PACKS.ITEMS);\n  if (!itemsPack) {\n    throw new Error(\n      `${CONSTANTS.LOG_PREFIX} | Cannot find default DnD5e items compendium (for indexing equipment) under name ${CONSTANTS.DEFAULT_PACKS.ITEMS}`,\n    );\n  }\n  await (itemsPack as any).getIndex({ fields: ['img', 'data.price', 'data.rarity'] });\n\n  const rulesPack = game.packs.get(CONSTANTS.DEFAULT_PACKS.RULES);\n  if (!rulesPack) {\n    throw new Error(\n      `${CONSTANTS.LOG_PREFIX} | Cannot find default DnD5e rules compendium (for indexing sidepanel rules) under name ${CONSTANTS.DEFAULT_PACKS.RULES}`,\n    );\n  }\n  await (rulesPack as any).getIndex({ fields: ['name', 'content'] });\n}\n\nexport async function getRaceEntries() {\n  const raceEntries = await ((getIndexEntriesForSource(SourceType.RACES) as unknown) as Promise<RaceEntry[]>);\n  // sanitize entries to remove anything nonconforming to a Feature (for now, until Race becomes a type)\n  return raceEntries.filter((r) => r.type == 'feat');\n}\n\nexport async function getRaceFeatureEntries() {\n  const raceFeatureEntries = await ((getIndexEntriesForSource(SourceType.RACIAL_FEATURES) as unknown) as Promise<\n    RacialFeatureEntry[]\n  >);\n  // sanitize entries to remove anything nonconforming to a Feature (for now at least, if Race Features become a type in the future)\n  return raceFeatureEntries.filter((f) => f.type == 'feat' && f?.data?.requirements !== '');\n}\n\nexport async function getClassEntries() {\n  const classEntries = await ((getIndexEntriesForSource(SourceType.CLASSES) as unknown) as Promise<ClassEntry[]>);\n  // sanitize entries to remove anything nonconforming to a Class\n  return classEntries.filter((c) => c.type == 'class');\n}\n\nexport async function getClassFeatureEntries() {\n  const classFeatureEntries = await ((getIndexEntriesForSource(SourceType.CLASS_FEATURES) as unknown) as Promise<\n    RacialFeatureEntry[]\n  >);\n  // sanitize entries to remove anything nonconforming to a Feature (for now at least, if Class Features become a type in the future)\n  return classFeatureEntries.filter((f) => f.type == 'feat' && f?.data?.requirements !== '');\n}\n\nexport async function getSpellEntries() {\n  const spellEntries = await ((getIndexEntriesForSource(SourceType.SPELLS) as unknown) as Promise<SpellEntry[]>);\n  // sanitize entries to remove anything nonconforming to a Spell\n  return spellEntries.filter((s) => s.type == 'spell');\n}\n\nexport async function getBackgroundFeatureEntries() {\n  const backgroundFeatureEntries = await ((getIndexEntriesForSource(\n    SourceType.BACKGROUND_FEATURES,\n  ) as unknown) as Promise<BackgroundFeatureEntry[]>);\n  // sanitize entries to remove anything nonconforming to a Feature (for now at least, if Background Features become a type in the future)\n  return backgroundFeatureEntries.filter((f) => f.type == 'feat');\n}\n\nexport async function getFeatEntries() {\n  const featEntries = await ((getIndexEntriesForSource(SourceType.FEATS) as unknown) as Promise<FeatEntry[]>);\n  // sanitize entries to remove anything nonconforming to a Feature (for now at least, if Feats become a type in the future)\n  return featEntries.filter((f) => f.type == 'feat');\n}\n\nexport async function getEquipmentEntries() {\n  const equipmentEntries = await ((game.packs.get(CONSTANTS.DEFAULT_PACKS.ITEMS)?.index as unknown) as Promise<\n    EquipmentEntry[]\n  >);\n  return equipmentEntries\n    .filter((e) => !['class', 'feat', 'spell'].includes(e.type))\n    .map((e) => ({ ...e, _pack: CONSTANTS.DEFAULT_PACKS.ITEMS }));\n}\n\nexport async function getRuleJournalEntryByName(journalName: string) {\n  const entries = await ((game.packs.get(CONSTANTS.DEFAULT_PACKS.RULES)?.index as unknown) as Promise<RuleEntry[]>);\n  return entries.find((e) => e.name === journalName);\n}\n\nasync function getIndexEntriesForSource(source: keyof Source) {\n  const sources: Source = (await game.settings.get(CONSTANTS.MODULE_NAME, SettingKeys.SOURCES)) as Source;\n\n  const indexEntries = [];\n  for (const packName of sources[source]) {\n    const pack = game.packs.get(packName);\n    if (!pack) ui.notifications?.warn(`No pack for name [${packName}]!`);\n    if (pack?.documentName !== 'Item') throw new Error(`${packName} is not an Item pack`);\n    const itemPack = pack as CompendiumCollection<CompendiumCollection.Metadata & { entity: 'Item' }>;\n    if ((itemPack as any).indexed) {\n      const packIndexEntries = [...(await itemPack.index)];\n      indexEntries.push(...packIndexEntries.map((e) => ({ ...e, _pack: packName })));\n    } else {\n      console.error(`Index not built for pack [${packName}] - skipping it`);\n    }\n  }\n  return indexEntries;\n}\n\nexport async function hydrateItems(indexEntries: Array<IndexEntry>): Promise<Item[]> {\n  console.log(`${CONSTANTS.LOG_PREFIX} | Hydrating items:`);\n  const worldItems = game.items;\n  if (!worldItems) throw new Error('game.items not initialized yet');\n\n  const itemPromises = indexEntries.map(async (indexEntry) => {\n    if ((indexEntry as any).custom) {\n      return indexEntry; // return custom items as-is\n    }\n    const quantity = (indexEntry as any).data?.quantity;\n    const item = await game.packs.get(indexEntry._pack)?.getDocument(indexEntry._id);\n    if (!item) throw new Error(`No item for id ${indexEntry._id}!`);\n    const itemForEmbedding = worldItems.fromCompendium(item as Item);\n    if (quantity) {\n      (itemForEmbedding!.data as any).quantity = quantity;\n    }\n    return itemForEmbedding;\n  });\n  return (await Promise.all(itemPromises)) as any;\n}\n\n// Entry types & functions that add corresponding fields for index creation\nexport type IndexEntry = {\n  _id: string;\n  _pack: string;\n  type: string;\n  name: string;\n  img: string;\n};\n\nexport type RaceEntry = IndexEntry & {\n  data: {\n    requirements: string;\n    description: { value: string };\n  };\n};\nfunction addRaceFields(fieldsToIndex: Set<string>, source: Source, packName: string) {\n  if (source[SourceType.RACES].includes(packName)) {\n    fieldsToIndex.add('data.requirements'); // for figuring subraces\n    fieldsToIndex.add('data.description.value'); // for sidebar\n  }\n}\n\nexport type RacialFeatureEntry = IndexEntry & {\n  data: { requirements: string };\n};\nfunction addRacialFeaturesFields(fieldsToIndex: Set<string>, source: Source, packName: string) {\n  if (source[SourceType.RACIAL_FEATURES].includes(packName)) {\n    fieldsToIndex.add('data.requirements'); // for mapping racial features to races/subraces\n  }\n}\n\nexport type ClassEntry = IndexEntry & {\n  data: {\n    description: { value: string };\n    hitDice: string;\n    saves: string[];\n    skills: {\n      number: number;\n      choices: string[];\n      value: string[];\n    };\n    spellcasting: {\n      ability: string;\n      progression: string;\n    };\n    levels: number;\n  };\n};\nfunction addClassFields(fieldsToIndex: Set<string>, source: Source, packName: string) {\n  if (source[SourceType.CLASSES].includes(packName)) {\n    fieldsToIndex.add('data.description.value'); // for sidebar\n    fieldsToIndex.add('data.hitDice');\n    fieldsToIndex.add('data.saves');\n    fieldsToIndex.add('data.skills');\n    fieldsToIndex.add('data.spellcasting');\n  }\n}\n\nexport type ClassFeatureEntry = IndexEntry & {\n  data: { requirements: string };\n};\nfunction addClassFeaturesFields(fieldsToIndex: Set<string>, source: Source, packName: string) {\n  if (source[SourceType.CLASS_FEATURES].includes(packName)) {\n    fieldsToIndex.add('data.requirements'); // for mapping class features to classes\n  }\n}\n\nexport type SpellEntry = IndexEntry & {\n  data: {\n    level: number;\n  };\n};\nfunction addSpellFields(fieldsToIndex: Set<string>, source: Source, packName: string) {\n  if (source[SourceType.SPELLS].includes(packName)) {\n    fieldsToIndex.add('data.level');\n  }\n}\n\nexport type FeatEntry = IndexEntry & {\n  data: { requirements: string };\n};\nfunction addFeatFields(fieldsToIndex: Set<string>, source: Source, packName: string) {\n  if (source[SourceType.FEATS].includes(packName)) {\n    fieldsToIndex.add('data.requirements'); // unsure if will be used, would like to at least mention the requirement.\n  }\n}\n\nexport type BackgroundFeatureEntry = IndexEntry & {\n  data: {\n    requirements: string;\n    source: string;\n  };\n};\nfunction addBackgroundFeaturesFields(fieldsToIndex: Set<string>, source: Source, packName: string) {\n  if (source[SourceType.BACKGROUND_FEATURES].includes(packName)) {\n    fieldsToIndex.add('data.requirements'); // to map possible background names\n    fieldsToIndex.add('data.source'); // to make sure this is a background feature\n  }\n}\n\nexport type EquipmentEntry = IndexEntry & {\n  data: {\n    price: number;\n    rarity: string;\n    quantity?: number;\n  };\n};\n\nexport type RuleEntry = {\n  _id: string;\n  name: string;\n  content: string;\n};\n","import { Step, StepEnum } from '../Step';\nimport HeroOption from '../options/HeroOption';\nimport FixedOption, { OptionType } from '../options/FixedOption';\nimport SettingKeys from '../settings';\nimport { getRuleJournalEntryByName } from '../indexUtils';\nimport { getAbilityModifierValue, getModuleSetting, setPanelScrolls } from '../utils';\n\nconst enum EntryMode {\n  ROLL = 'roll',\n  STANDARD_ARRAY = 'standard',\n  POINT_BUY = 'point-buy',\n  MANUAL_ENTRY = 'manual',\n}\n\nclass _Abilities extends Step {\n  constructor() {\n    super(StepEnum.Abilities);\n  }\n\n  section = () => $('#abDiv');\n\n  possibleValues: number[] = [];\n\n  pointBuy = false;\n\n  async setListeners() {\n    // entry mode\n    $('[data-mode]', this.section).on('click', async (event) => {\n      const mode = $(event.target).data('mode');\n\n      this.possibleValues = [];\n      switch (mode) {\n        case EntryMode.ROLL:\n          this.possibleValues = await prepareRolls();\n          break;\n        case EntryMode.STANDARD_ARRAY:\n          this.possibleValues = [15, 14, 13, 12, 10, 8];\n          break;\n        case EntryMode.POINT_BUY:\n          this.possibleValues = [15, 14, 13, 12, 11, 10, 9, 8];\n          $('[data-hct-point-buy-score]').val(0); // reset current score\n          break;\n        case EntryMode.MANUAL_ENTRY:\n          this.possibleValues = [20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1];\n          break;\n      }\n      // handle Point Buy specifics\n      $('[data-hct-point-buy]', this.section).toggle(mode == EntryMode.POINT_BUY);\n      this.pointBuy = mode == EntryMode.POINT_BUY;\n\n      fillAbilitySelects(this.possibleValues, this.section, this.pointBuy);\n      recalculateTotalsAndModifiers(this.pointBuy);\n    });\n\n    //update values when an ability select is changed\n    $('[data-hct-ability-score]', this.section).on('change', (e) => recalculateTotalsAndModifiers(this.pointBuy));\n  }\n\n  async renderData() {\n    setPanelScrolls(this.section());\n\n    // Enable only DM-allowed methods\n    const $methodsContext = $('[data-hct-ability-methods]', this.section);\n    $('[data-mode=\"roll\"]', $methodsContext).prop('disabled', !getModuleSetting(SettingKeys.ENABLE_ASI_ROLL));\n    $('[data-mode=\"standard\"]', $methodsContext).prop('disabled', !getModuleSetting(SettingKeys.ENABLE_ASI_STANDARD));\n    $('[data-mode=\"point-buy\"]', $methodsContext).prop('disabled', !getModuleSetting(SettingKeys.ENABLE_ASI_POINTBUY));\n    $('[data-mode=\"manual\"]', $methodsContext).prop('disabled', !getModuleSetting(SettingKeys.ENABLE_ASI_MANUAL));\n\n    // set proper dice to the Roll button\n    const dice = game.i18n.format('HCT.Abilities.Buttons.Roll', {\n      dice: getModuleSetting(SettingKeys.ABILITY_ROLL_FORMULA),\n    });\n    $('[data-mode=\"roll\"]', $methodsContext).html(dice);\n\n    // Show rules on the side panel\n    const rulesCompendiumName = game.i18n.localize('HCT.Abilities.RulesJournalName');\n    const abilitiesRules = await getRuleJournalEntryByName(rulesCompendiumName);\n    if (abilitiesRules) {\n      $('[data-hct_abilities_description]', this.section()).html(TextEditor.enrichHTML(abilitiesRules.content));\n    } else {\n      console.error(`Unable to find abilities' rule journal on compendium ${rulesCompendiumName}`);\n    }\n\n    // setting default values\n    const $selects = $('[data-hct-ability-score]', this.section);\n    $selects.append($(`<option value=10>10</option>`));\n\n    // set pointbuy max and score\n    const pointBuyMax = getModuleSetting(SettingKeys.POINT_BUY_LIMIT) as number;\n    $('[data-hct-point-buy-max]').val(pointBuyMax);\n  }\n\n  update() {\n    const $raceStats = $('[data-hct-race-ability]');\n    if ($raceStats.length == 0) {\n      $(`[data-hct-ability-score-race-bonus]`).val(0).html('+0');\n    } else {\n      $raceStats.each((i, e) => {\n        const ability = e.dataset.hctRaceAbility;\n        const value = (e as HTMLInputElement).value;\n        $(`[data-hct-ability-score-race-bonus=${ability}]`)\n          .val(value)\n          .html(value.startsWith('-') ? value : '+' + value);\n      });\n    }\n    recalculateTotalsAndModifiers(this.pointBuy);\n  }\n\n  getOptions(): HeroOption[] {\n    this.clearOptions();\n\n    $('[data-hct-ability-score]', this.section).each((i, e) => {\n      const ability = e.dataset.hctAbilityScore;\n      const value = (e as HTMLOptionElement).value;\n      if (ability && value) {\n        this.stepOptions.push(\n          new FixedOption(this.step, `data.abilities.${ability}.value`, value, 'UNUSED', {\n            addValues: true,\n            type: OptionType.NUMBER,\n          }),\n        );\n      }\n    });\n    return this.stepOptions;\n  }\n}\nconst AbilitiesTab: Step = new _Abilities();\nexport default AbilitiesTab;\n\nasync function prepareRolls() {\n  const abilityRoll = getModuleSetting(SettingKeys.ABILITY_ROLL_FORMULA) as string;\n  const roll = await new Roll(\n    `${abilityRoll} + ${abilityRoll} + ${abilityRoll} + ${abilityRoll} + ${abilityRoll} + ${abilityRoll}`,\n  ).evaluate({ async: true });\n  if (getModuleSetting(SettingKeys.SHOW_ROLLS_AS_MESSAGES)) {\n    roll.toMessage({ flavor: game.i18n.localize('HCT.Abilities.RollChatFlavor') });\n  }\n  return roll.result.split('+').map((r) => Number.parseInt(r.trim()));\n}\n\nfunction fillAbilitySelects(possibleValues: number[], $section: any, isPointBuy: boolean) {\n  const $selects = $('[data-hct-ability-score]', $section);\n  $selects.empty();\n  if (!isPointBuy) {\n    $selects.append(\n      $(\n        `<option selected=\"true\" disabled=\"disabled\">${game.i18n.localize('HCT.Abilities.SelectPlaceholder')}</option>`,\n      ),\n    );\n  }\n  possibleValues.forEach((v) => {\n    const opt = $(`<option value='${v}' ${isPointBuy && v == 8 ? 'selected' : ''}>${v}</option>`);\n    $selects.append(opt);\n  });\n}\n\nfunction recalculateTotalsAndModifiers(isPointBuy: boolean) {\n  const abilities = Object.keys((game as any).dnd5e.config.abilities);\n  let points = 0;\n  abilities.forEach((ab) => {\n    const score = parseInt(($(`[data-hct-ability-score='${ab}']`).val() as string) ?? 10);\n    const race = parseInt($(`[data-hct-ability-score-race-bonus='${ab}']`).val() as string);\n    const $total = $(`[data-hct-ability-score-total='${ab}']`);\n    const $mod = $(`[data-hct-ability-score-mod='${ab}']`);\n\n    const total = score + race;\n    $total.val(total).html(total + '');\n    const modifier = getAbilityModifierValue(total);\n    $mod.html((modifier < 0 ? '' : '+') + modifier);\n\n    if (isPointBuy) {\n      points += getPointBuyCost(score);\n    }\n  });\n  if (isPointBuy) {\n    $('[data-hct-point-buy-score]').val(points);\n  }\n}\n\nfunction getPointBuyCost(score: number) {\n  if (score < 14) return score - 8;\n  return (score - 13) * 2 + 5;\n}\n","import { StepEnum } from '../Step';\nimport { ActorDataConstructorData } from '@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs/actorData';\nimport HeroOption, { apply } from './HeroOption';\n\n/**\n * Represents a value needs to be selected by the player with a single output onto the created actor.\n * (e.g. Dwarven's Tool Proficiency is a single option between three defined ones)\n * @class\n */\nexport default class SelectableOption implements HeroOption {\n  constructor(\n    readonly origin: StepEnum,\n    readonly key: string,\n    private options: { key: string; value: string }[],\n    private label: string,\n    readonly settings: {\n      addValues: boolean;\n      default?: string;\n      customizable: boolean;\n    } = { addValues: false, customizable: false },\n    readonly changeCallback?: (data?: any) => void,\n    readonly callbackMapping?: Map<string, string>,\n  ) {\n    this.$elem = $(`<select class=\"hct-option-select\">`);\n    if (!settings.default) {\n      this.$elem.append(\n        $(`<option value=\"\" selected disabled hidden>\n      ${game.i18n.localize('HCT.Common.SelectPlaceholder')}</option>`),\n      );\n    }\n    if (this.settings.customizable) {\n      this.$elem.append(\n        $(`<option value=\"custom\">\n      ${game.i18n.localize('HCT.Common.SelectCreateOne')}</option>`),\n      );\n      this.$customValue = $(`<input type=\"text\" placeholder=\"${game.i18n.localize('HCT.Common.RequiredName')}\">`);\n      this.$elem.on('change', () => {\n        const val = this.$elem.val() as string;\n        this.isCustom = val === 'custom';\n        this.$customValue.toggle(this.isCustom);\n        if (this.isCustom) {\n          this.$customValue.val('');\n        }\n        if (changeCallback) changeCallback(val === 'custom' ? val : this.callbackMapping!.get(val));\n      });\n    }\n    this.$elem.append(\n      this.options.map((option) =>\n        $(\n          `<option value=\"${option.key}\" ${option.key === settings.default ? 'selected' : ''}>${game.i18n.localize(\n            option.value,\n          )}</option>`,\n        ),\n      ),\n    );\n  }\n\n  isCustom = false;\n\n  $customValue!: JQuery;\n\n  isFulfilled() {\n    return !!this.value();\n  }\n\n  applyToHero(actor: ActorDataConstructorData) {\n    apply(actor, this.key, this.value(), this.settings.addValues);\n  }\n\n  $elem: JQuery;\n\n  /**\n   * Builds the HTML element for this option and appends it to the parent\n   * @param {JQuery} $parent\n   */\n  render($parent: JQuery, options?: { beforeParent: boolean }): void {\n    const $block = $('<div class=\"hct-option\">');\n    if (this.label) {\n      $block.append($('<span class=\"hct-option-label\">').text(this.label));\n    }\n    $block.append(this.$elem);\n    const $container = $('<div>');\n    if (this.settings.customizable) {\n      $container.append($block);\n      $container.append($('<div class=\"hct-option\">').append(this.$customValue));\n      this.$customValue.hide();\n    }\n    if (options?.beforeParent) {\n      $parent.before(this.settings.customizable ? $container : $block);\n    } else {\n      $parent.append(this.settings.customizable ? $container : $block);\n    }\n  }\n\n  /**\n   * @returns the current value of this option\n   */\n  value(): any {\n    if (this.settings.customizable && this.$customValue.val()) {\n      return this.$customValue.val();\n    }\n    return this.$elem.val();\n  }\n}\n","import { ActorDataConstructorData } from '@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs/actorData';\nimport { StepEnum } from '../Step';\nimport HeroOption from './HeroOption';\n\nexport default class DeletableOption implements HeroOption {\n  constructor(\n    readonly origin: StepEnum,\n    private option: HeroOption,\n    readonly settings: { addValues: boolean; rightPadding?: boolean } = { addValues: true },\n    private deleteCallback: (params?: any) => any,\n    readonly callbackParams?: any,\n    readonly returnThis: boolean = false,\n  ) {}\n  key = '';\n\n  private deleted = false;\n\n  render($parent: JQuery<HTMLElement>): void {\n    const $container = $(\n      `<div class=\"hct-flex hct-flex-justify-sb hct-width-full\" ${\n        this.callbackParams ? 'id=\"hct_deletable_' + this.callbackParams + '\"' : ''\n      }>`,\n    );\n    const $deleteButton = $(\n      `<button class=\"hct-no-border hct-no-background hct-width-fit hct-hover-no-shadow hct-hover-accent ${\n        this.settings.rightPadding ? 'hct-padding-r-tiny' : ''\n      }\"><i class=\"fas fa-trash\"></i></button>`,\n    );\n    $deleteButton.on('click', () => {\n      this.deleted = true;\n      this.deleteCallback((this.returnThis ? this : this.callbackParams) || this);\n    });\n    this.option.render($container);\n    $container.append($deleteButton);\n    $parent.append($container);\n  }\n  value() {\n    return this.deleted ? undefined : this.option.value();\n  }\n  isFulfilled(): boolean {\n    return this.deleted ? true : this.option.isFulfilled();\n  }\n  applyToHero(actor: ActorDataConstructorData): void {\n    if (!this.deleted) this.option.applyToHero(actor);\n  }\n}\n","import { StepEnum } from '../Step';\nimport { ActorDataConstructorData } from '@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs/actorData';\nimport SelectableOption from './SelectableOption';\nimport HeroOption from './HeroOption';\nimport InputOption from './InputOption';\nimport DeletableOption from './DeletableOption';\n\n/**\n * Represents an array of values selected by the player for the created actor.\n * (e.g. A class allowing to pick 2 skills from a list)\n * @class\n */\nexport default class MultiOption implements HeroOption {\n  constructor(\n    readonly origin: StepEnum,\n    readonly key: string,\n    private options: { key: string; value: string }[],\n    private quantity: number,\n    private label: string,\n    readonly settings: {\n      addValues: boolean;\n      expandable?: boolean;\n      customizable?: boolean;\n    } = { addValues: false, expandable: false, customizable: false },\n  ) {}\n\n  isFulfilled() {\n    return this.value().length > 0;\n  }\n\n  applyToHero(actor: ActorDataConstructorData) {\n    this.optionMap.forEach((v) => v.applyToHero(actor));\n  }\n\n  optionMap: Map<string, HeroOption> = new Map<string, HeroOption>();\n  $container!: JQuery;\n\n  /**\n   * Builds the HTML element for this option and appends it to the parent\n   * @param {JQuery} $p\n   */\n  render($parent: JQuery): void {\n    this.$container = $(`<div class=\"hct-options-container\">`);\n    const $titleDiv = $('<div class=\"hct-flex hct-flex-justify-sb hct-width-full\" data-hct_opt_container_title>');\n    const $title = $(`<p class=\"hct-options-container-label\">${this.label}</p>`);\n    $titleDiv.append($title);\n\n    if (this.settings.expandable) {\n      const $addButton = $(\n        '<button class=\"hct-no-border hct-no-background hct-width-fit hct-hover-no-shadow hct-hover-accent-alt\"><i class=\"fas fa-plus\"></i></button>',\n      );\n      $addButton.on('click', () => {\n        if (!this.settings.customizable) {\n          this.addOption();\n        } else {\n          const d = new Dialog({\n            title: game.i18n.localize('HCT.Common.ProfDialogTitle'),\n            content: `<p>${game.i18n.localize('HCT.Common.ProfDialogContent')}</p>`,\n            buttons: {\n              standard: {\n                label: game.i18n.localize('HCT.Common.AddStandard'),\n                callback: () => this.addOption(),\n              },\n              custom: {\n                label: game.i18n.localize('HCT.Common.AddCustom'),\n                callback: () => this.addCustomOption(),\n              },\n            },\n            default: 'standard',\n          });\n          d.render(true);\n        }\n      });\n      $titleDiv.append($addButton);\n    }\n    this.$container.append($titleDiv);\n\n    this.optionMap = new Map();\n    for (let i = 0; i < this.quantity; i++) {\n      const o = new SelectableOption(this.origin, this.key, this.options, ' ', {\n        ...this.settings,\n        customizable: false,\n      });\n      this.optionMap.set(foundry.utils.randomID(), o);\n      o.render(this.$container);\n    }\n\n    $parent.append(this.$container);\n  }\n\n  addOption(): void {\n    const o = new DeletableOption(\n      this.origin,\n      new SelectableOption(this.origin, this.key, this.options, ' ', {\n        ...this.settings,\n        customizable: false,\n      }),\n      { addValues: this.settings.addValues, rightPadding: true },\n      (arg: any) => this.onDelete(arg),\n      foundry.utils.randomID(),\n    );\n    this.optionMap.set(foundry.utils.randomID(), o);\n    o.render(this.$container);\n  }\n\n  addCustomOption(): void {\n    const o = new DeletableOption(\n      this.origin,\n      new InputOption(this.origin, this.key, '...', ' ', { ...this.settings, type: 'text', preLabel: ' ' }),\n      { addValues: this.settings.addValues, rightPadding: true },\n      (arg: any) => this.onDelete(arg),\n      foundry.utils.randomID(),\n    );\n    this.optionMap.set(foundry.utils.randomID(), o);\n    o.render(this.$container);\n  }\n\n  onDelete(deletableId: string) {\n    if (deletableId) {\n      $(`#hct_deletable_${deletableId}`, this.$container).remove();\n    }\n    this.optionMap.delete(deletableId);\n  }\n\n  /**\n   * @returns the current value of this option\n   */\n  value(): any[] {\n    const values: any[] = [];\n    this.optionMap.forEach((o) => values.push(o.value()));\n    return values;\n  }\n}\n","import { getEquipmentEntries } from './indexUtils';\nimport HeroOption from './options/HeroOption';\nimport MultiOption from './options/MultiOption';\nimport { StepEnum } from './Step';\n\nexport type OptionSettings = {\n  step: StepEnum;\n  $parent: JQuery;\n  pushTo: HeroOption[];\n  quantity: number;\n  filteredOptions?: KeyValue[];\n  addValues: boolean;\n  expandable: boolean;\n  customizable: boolean;\n};\n\ntype KeyValue = {\n  key: string;\n  value: string;\n};\n\nexport function prepareSkillOptions(optionSettings: OptionSettings): MultiOption {\n  const foundrySkills = (game as any).dnd5e.config.skills;\n  const skillChoices: KeyValue[] = Object.keys(foundrySkills).map((k) => ({ key: k, value: foundrySkills[k] }));\n  return prepareOptions(\n    optionSettings,\n    'skills',\n    optionSettings.filteredOptions ?? skillChoices,\n    game.i18n.localize('HCT.Common.SkillProficiencies'),\n  );\n}\n\nexport function prepareLanguageOptions(optionSettings: OptionSettings): MultiOption {\n  const foundryLanguages = (game as any).dnd5e.config.languages;\n  const langChoices: KeyValue[] = Object.keys(foundryLanguages).map((k) => ({ key: k, value: foundryLanguages[k] }));\n  return prepareOptions(\n    optionSettings,\n    'languages',\n    optionSettings.filteredOptions ?? langChoices,\n    game.i18n.localize('HCT.Common.LanguageProficiencies'),\n  );\n}\n\nexport async function prepareToolOptions(optionSettings: OptionSettings) {\n  const foundryToolTypes = (game as any).dnd5e.config.toolProficiencies;\n  const foundryTools = (game as any).dnd5e.config.toolIds;\n  const toolTypeChoices: KeyValue[] = Object.keys(foundryToolTypes).map((k) => ({\n    key: k,\n    value: `All ${foundryToolTypes[k]}`,\n  }));\n  const indexEntries = await getEquipmentEntries();\n  const toolChoices: KeyValue[] = Object.keys(foundryTools).map((k) => {\n    const id = foundryTools[k];\n    const item = indexEntries?.find((i) => i._id === id);\n    return { key: k, value: item!.name! };\n  });\n  return prepareOptions(\n    optionSettings,\n    'toolProf',\n    optionSettings.filteredOptions ?? [...toolTypeChoices, ...toolChoices],\n    game.i18n.localize('HCT.Common.ToolProficiencies'),\n  );\n}\n\nexport async function prepareWeaponOptions(optionSettings: OptionSettings) {\n  const foundryWeaponTypes = (game as any).dnd5e.config.weaponProficiencies;\n  const foundryWeapons = (game as any).dnd5e.config.weaponIds;\n  const weaponTypeChoices: KeyValue[] = Object.keys(foundryWeaponTypes).map((k) => ({\n    key: k,\n    value: `All ${foundryWeaponTypes[k]}`,\n  }));\n  const indexEntries = await getEquipmentEntries();\n  const weaponChoices: KeyValue[] = Object.keys(foundryWeapons).map((k) => {\n    const id = foundryWeapons[k];\n    const item = indexEntries?.find((i) => i._id === id);\n    return { key: k, value: item!.name! };\n  });\n  return prepareOptions(\n    optionSettings,\n    'weaponProf',\n    optionSettings.filteredOptions ?? [...weaponTypeChoices, ...weaponChoices],\n    game.i18n.localize('HCT.Common.WeaponProficiencies'),\n  );\n}\n\nexport async function prepareArmorOptions(optionSettings: OptionSettings) {\n  const foundryArmorTypes = (game as any).dnd5e.config.armorProficiencies;\n  const foundryArmor = (game as any).dnd5e.config.armorIds;\n  const armorTypeChoices: KeyValue[] = Object.keys(foundryArmorTypes).map((k) => ({\n    key: k,\n    value: `All ${foundryArmorTypes[k]}`,\n  }));\n  const indexEntries = await getEquipmentEntries();\n  const foundryArmorChoices: KeyValue[] = Object.keys(foundryArmor).map((k) => {\n    const id = foundryArmor[k];\n    const itemEntry = indexEntries?.find((i) => i._id === id);\n    return { key: k, value: itemEntry!.name! };\n  });\n  return prepareOptions(\n    optionSettings,\n    'armorProf',\n    optionSettings.filteredOptions ?? [...armorTypeChoices, ...foundryArmorChoices],\n    game.i18n.localize('HCT.Common.ArmorProficiencies'),\n  );\n}\n\nexport function prepareOptions(\n  optionSettings: OptionSettings,\n  key: string,\n  options: KeyValue[],\n  containerLabel: string,\n): MultiOption {\n  const container = new MultiOption(optionSettings.step, key, options, optionSettings.quantity, containerLabel, {\n    addValues: optionSettings.addValues,\n    expandable: optionSettings.expandable,\n    customizable: optionSettings.customizable,\n  });\n  return container;\n}\n","import { StepEnum } from '../Step';\nimport { ActorDataConstructorData } from '@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs/actorData';\nimport HeroOption, { apply } from './HeroOption';\n\n/**\n * Represents a value that is given to the created actor but doesn't need user input\n * e.g. the foundry Items that will be added to the Actor, like Race/Class.\n * @class\n */\nexport default class HiddenOption implements HeroOption {\n  constructor(\n    readonly origin: StepEnum,\n    readonly key: string,\n    readonly opt: any,\n    readonly settings: {\n      addValues: boolean;\n    } = { addValues: false },\n  ) {}\n\n  render(parent: JQuery<HTMLElement>): void {\n    throw new Error('Hidden hero options should not be rendered');\n  }\n\n  value(): any {\n    return this.opt;\n  }\n\n  isFulfilled(): boolean {\n    return !!this.value();\n  }\n\n  applyToHero(actor: ActorDataConstructorData): void {\n    apply(actor, this.key, this.value(), this.settings.addValues);\n  }\n}\n","import { StepEnum } from '../Step';\nimport { ActorDataConstructorData } from '@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs/actorData';\nimport * as Constants from '../constants';\nimport HeroOption, { apply } from './HeroOption';\nimport { IndexEntry } from '../indexUtils';\n\n/**\n * Represents a value needs to be selected by the player with a single output onto the created actor.\n * (e.g. Dwarven's Tool Proficiency is a single option between three defined ones)\n * @class\n */\nexport default class SearchableIndexEntryOption implements HeroOption {\n  readonly settings: {\n    addValues: boolean;\n    default?: string;\n    customizable: boolean;\n  } = { addValues: true, customizable: false };\n\n  constructor(\n    readonly origin: StepEnum,\n    readonly key: string,\n    private options: Array<IndexEntry>,\n    private selectCallback?: (id: string) => any,\n    private placeholder?: string,\n  ) {\n    this.searchArray = [];\n  }\n\n  isFulfilled() {\n    return !!this.value();\n  }\n\n  applyToHero(actor: ActorDataConstructorData) {\n    apply(actor, this.key, [this.value()], this.settings.addValues);\n  }\n\n  $input!: JQuery;\n  $resultBox!: JQuery;\n  searchArray: Array<IndexEntry>;\n  selected?: IndexEntry;\n\n  render($parent: JQuery, options?: { prepend: boolean }): void {\n    const $form = $(`<form data-hct-searchbar autocomplete=\"off\">`);\n    const $searchWrapper = $(`<div class=\"hct-search-wrapper\">`);\n    this.$input = $(\n      `<input type=\"text\" placeholder=\"${this.placeholder ?? game.i18n.localize('HCT.Common.Searchbar.Placeholder')}\">`,\n    );\n    this.$input.on('click', (e: any) => {\n      if (this.$input.val() == '') {\n        this.searchArray = this.options;\n      }\n      this.$input.trigger('select');\n      $searchWrapper.addClass('active');\n      this.showSuggestions(this.searchArray);\n      this.setSuggestionsInteraction($searchWrapper);\n    });\n    this.$input.on('keyup', (e: any) => {\n      const userInput = (e.target as any).value;\n      if (userInput) {\n        this.searchArray = this.options.filter((value) => {\n          return (value.name as any)\n            .toLocaleLowerCase()\n            .replaceAll(/\\s/g, '')\n            .includes(userInput.toLocaleLowerCase().replaceAll(/\\s/g, ''));\n        });\n        $searchWrapper.addClass('active');\n        this.showSuggestions(this.searchArray);\n        this.setSuggestionsInteraction($searchWrapper);\n      } else {\n        $searchWrapper.removeClass('active');\n      }\n    });\n    $searchWrapper.append(this.$input);\n\n    this.$resultBox = $(`<div class=\"hct-search-autocom-box\" data-hct-searchbar-results>`);\n    $searchWrapper.append(this.$resultBox);\n\n    $form.append($searchWrapper);\n    $form.on('submit', (e) => false);\n    if (options?.prepend) {\n      $parent.prepend($form);\n    } else {\n      $parent.append($form);\n    }\n  }\n\n  private setSuggestionsInteraction($searchWrapper: JQuery<HTMLElement>) {\n    $('div', this.$resultBox).on('click', (event) => {\n      const id = $(event.currentTarget).data('key');\n      $searchWrapper.removeClass('active');\n      this.$input.val(this.options.find((o) => o._id == id)?.name ?? id);\n      if (this.selectCallback) this.selectCallback(id);\n      this.selected = this.options.find((o) => o._id === id || o.name === id); // Results use id, Items use name\n    });\n  }\n\n  value(): any {\n    return this.selected;\n  }\n\n  showSuggestions(searchArray: Array<IndexEntry>) {\n    let listData;\n    if (!searchArray.length) {\n      listData = `<li>${'No matches'}</li>`;\n    } else {\n      listData = searchArray\n        .map(\n          (result) =>\n            `<li>\n              <div class=\"hct-icon-with-context\" data-key=\\\"${result._id ?? result.name}\\\">\n                <img class=\"hct-icon-square-med hct-background-black hct-no-border\" src=\"${\n                  result.img ?? Constants.MYSTERY_MAN\n                }\">\n                <span>${result.name}</span>\n              </div>\n            </li>`,\n        )\n        .join('');\n    }\n    this.$resultBox.html(listData);\n  }\n}\n","/*\n  Functions used exclusively on the Race tab\n*/\nimport { Step, StepEnum } from '../Step';\nimport * as Utils from '../utils';\nimport * as Constants from '../constants';\nimport * as ProficiencyUtils from '../proficiencyUtils';\nimport HeroOption from '../options/HeroOption';\nimport HiddenOption from '../options/HiddenOption';\nimport SelectableOption from '../options/SelectableOption';\nimport FixedOption, { OptionType } from '../options/FixedOption';\nimport InputOption from '../options/InputOption';\nimport SearchableIndexEntryOption from '../options/SearchableIndexEntryOption';\nimport {\n  FeatEntry,\n  getFeatEntries,\n  getRaceEntries,\n  getRaceFeatureEntries,\n  IndexEntry,\n  RaceEntry,\n  RacialFeatureEntry,\n} from '../indexUtils';\nimport SettingKeys from '../settings';\n\ntype KeyValue = {\n  key: string;\n  value: string;\n};\n\nclass _Race extends Step {\n  raceEntries?: RaceEntry[];\n  pickableRaces?: RaceEntry[];\n  raceFeatures?: RacialFeatureEntry[];\n\n  feats?: FeatEntry[];\n\n  $context!: JQuery;\n\n  subraceBlacklist?: string[];\n\n  constructor() {\n    super(StepEnum.Race);\n  }\n\n  section = () => $('#raceDiv');\n\n  setListeners(): void {\n    this.$context = $('[data-hct_race_data]', this.section());\n  }\n\n  async setSourceData() {\n    this.raceEntries = await getRaceEntries();\n    const raceNames = this.raceEntries.filter((entry) => entry.data?.requirements == '').map((race) => race.name);\n\n    const raceFeatureIndexEntries = await getRaceFeatureEntries();\n    this.raceFeatures = raceFeatureIndexEntries?.filter((entry) => !raceNames.includes(entry.name)); //filters out subraces from features\n\n    const featIndexEntries = await getFeatEntries();\n    this.feats = featIndexEntries.sort((a, b) => a.name.localeCompare(b.name));\n\n    this.subraceBlacklist = (Utils.getModuleSetting(SettingKeys.SUBRACES_BLACKLIST) as string)\n      .split(';')\n      .map((e) => e.trim());\n  }\n\n  renderData(): void {\n    Utils.setPanelScrolls(this.section());\n    $('[data-hct_race_data]').hide();\n    if (!this.raceEntries) {\n      ui.notifications!.error(game.i18n.format('HCT.Error.UpdateValueLoad', { value: 'Races' }));\n      return;\n    }\n\n    const searchableOption = new SearchableIndexEntryOption(\n      this.step,\n      'item',\n      getPickableRaces(this.raceEntries, this.subraceBlacklist ?? []),\n      (raceId) => {\n        // callback on selected\n        if (!this.raceEntries) {\n          ui.notifications!.error(game.i18n.format('HCT.Error.UpdateValueLoad', { value: 'Races' }));\n          return;\n        }\n        const selectedRace = this.raceEntries.find((e) => e._id === raceId);\n        if (!selectedRace) {\n          throw new Error(`No race found for id ${raceId}`);\n        }\n        const parentRace = getParentRace(selectedRace, this.raceEntries);\n        this.updateRace(selectedRace.name, parentRace ? [parentRace, selectedRace] : [selectedRace]);\n\n        // update icon and description\n        $('[data-hct_race_icon]').attr('src', selectedRace.img || Constants.MYSTERY_MAN);\n        if (parentRace) {\n          $('[data-hct_race_description]').html(TextEditor.enrichHTML(parentRace.data.description.value));\n          $('[data-hct_subrace_description]').html(TextEditor.enrichHTML(selectedRace.data.description.value));\n        } else {\n          $('[data-hct_race_description]').html(TextEditor.enrichHTML(selectedRace.data.description.value));\n          $('[data-hct_subrace_description]').empty();\n        }\n        $('[data-hct_subrace_separator]').toggle(!!parentRace);\n      },\n      game.i18n.localize('HCT.Race.Select.Default'),\n    );\n    searchableOption.render($('[data-hct-race-search]'));\n  }\n\n  updateRace(raceName: string, raceItems: RaceEntry[]) {\n    this.clearOptions();\n    this.resetFeat();\n\n    this.setAbilityScoresUi();\n    this.setSizeUi();\n    this.setSensesUi();\n    this.setMovementUi();\n    this.setProficienciesUi();\n    this.setRaceFeaturesUi(raceItems);\n    this.setFeatsUi();\n\n    this.$context.show();\n\n    this.stepOptions.push(new HiddenOption(StepEnum.Race, 'items', raceItems, { addValues: true }));\n    this.stepOptions.push(new HiddenOption(StepEnum.Race, 'data.details.race', raceName));\n  }\n\n  resetFeat() {\n    $('[data-hct_feat_icon] img', this.$context)\n      .attr('src', Constants.MYSTERY_MAN)\n      .removeClass('hct-hover-shadow-accent');\n  }\n\n  async setProficienciesUi() {\n    const $proficienciesSection = $('section', $('[data-hct_race_area=proficiencies]', this.$context)).empty();\n    const options = [];\n    options.push(\n      ProficiencyUtils.prepareSkillOptions({\n        step: this.step,\n        $parent: $proficienciesSection,\n        pushTo: this.stepOptions,\n        quantity: 0,\n        addValues: true,\n        expandable: true,\n        customizable: false,\n      }),\n    );\n\n    options.push(\n      await ProficiencyUtils.prepareWeaponOptions({\n        step: this.step,\n        $parent: $proficienciesSection,\n        pushTo: this.stepOptions,\n        quantity: 0,\n        addValues: true,\n        expandable: true,\n        customizable: true,\n      }),\n    );\n\n    options.push(\n      await ProficiencyUtils.prepareArmorOptions({\n        step: this.step,\n        $parent: $proficienciesSection,\n        pushTo: this.stepOptions,\n        quantity: 0,\n        addValues: true,\n        expandable: true,\n        customizable: true,\n      }),\n    );\n\n    options.push(\n      await ProficiencyUtils.prepareToolOptions({\n        step: this.step,\n        $parent: $proficienciesSection,\n        pushTo: this.stepOptions,\n        quantity: 0,\n        addValues: true,\n        expandable: true,\n        customizable: true,\n      }),\n    );\n\n    options.push(\n      ProficiencyUtils.prepareLanguageOptions({\n        step: this.step,\n        $parent: $proficienciesSection,\n        pushTo: this.stepOptions,\n        quantity: 0,\n        addValues: true,\n        expandable: true,\n        customizable: true,\n      }),\n    );\n\n    options.forEach((o) => o.render($proficienciesSection));\n    this.stepOptions.push(...options);\n  }\n\n  setMovementUi(): void {\n    const movementOption = new InputOption(StepEnum.Race, 'data.attributes.movement.walk', '', 30, {\n      addValues: false,\n      type: 'number',\n      preLabel: game.i18n.localize(`HCT.Common.Movement.walk`),\n      postLabel: 'ft',\n      class: 'hct-width-half',\n    });\n    const $movementSection = $('section', $('[data-hct_race_area=movement]', this.$context)).empty();\n    movementOption.render($movementSection);\n    this.stepOptions.push(movementOption);\n  }\n\n  setSensesUi(): void {\n    const sensesOption = new InputOption(StepEnum.Race, 'data.attributes.senses.darkvision', '', 0, {\n      addValues: false,\n      type: 'number',\n      preLabel: game.i18n.localize(`HCT.Common.Senses.darkvision`),\n      postLabel: 'ft',\n      class: 'hct-width-half',\n    });\n    const $sensesSection = $('section', $('[data-hct_race_area=senses]', this.$context)).empty();\n    sensesOption.render($sensesSection);\n    this.stepOptions.push(sensesOption);\n  }\n\n  setSizeUi(): void {\n    const sizeOption = new SelectableOption(StepEnum.Race, 'data.traits.size', getSizeOptions(), '', {\n      addValues: false,\n      default: 'med',\n      customizable: false,\n    });\n    const $sizeSection = $('section', $('[data-hct_race_area=size]', this.$context)).empty();\n    sizeOption.render($sizeSection);\n    this.stepOptions.push(sizeOption);\n  }\n\n  setAbilityScoresUi(): void {\n    const foundryAbilities = (game as any).dnd5e.config.abilities;\n    const options = Object.keys(foundryAbilities).map((key) => {\n      return new InputOption(StepEnum.Race, `data.abilities.${(key as string).toLowerCase()}.value`, '', 0, {\n        addValues: true,\n        type: 'number',\n        preLabel: `${foundryAbilities[key]}`,\n        class: 'hct-width-half',\n        data: `data-hct-race-ability='${key}'`,\n      });\n    });\n    const $abilityScoreSection = $('section', $('[data-hct_race_area=abilityScores]', this.$context)).empty();\n    options.forEach((o) => o.render($abilityScoreSection));\n    this.stepOptions.push(...options);\n  }\n\n  setRaceFeaturesUi(raceItems: IndexEntry[]): void {\n    const options: HeroOption[] = [];\n    const raceFeatures: RacialFeatureEntry[] = Utils.filterItemList({\n      filterValues: raceItems.map((r) => r.name!),\n      filterField: 'data.requirements',\n      itemList: this.raceFeatures!,\n    });\n    raceFeatures.forEach((feature) => {\n      const featureOption = new FixedOption(RaceTab.step, 'items', feature, undefined, {\n        addValues: true,\n        type: OptionType.ITEM,\n      });\n      options.push(featureOption);\n    });\n\n    const $raceFeaturesSection = $('section', $('[data-hct_race_area=features]', this.$context)).empty();\n    options.forEach((o) => o.render($raceFeaturesSection));\n    this.stepOptions.push(...options);\n  }\n\n  setFeatsUi(): void {\n    const featOption: HeroOption = new SearchableIndexEntryOption(this.step, 'items', this.feats ?? [], (featId) => {\n      const featEntry = this.feats?.find((f) => f._id == featId);\n      if (!featEntry) {\n        ui.notifications!.error(game.i18n.format('HCT.Error.UpdateValueLoad', { value: 'Feats' }));\n        return;\n      }\n      const $imgLink = $('[data-hct_feat_icon]', this.$context);\n      $imgLink.attr('data-pack', featEntry._pack ?? '');\n      $imgLink.attr('data-id', featEntry._id ?? '');\n      $('img', $imgLink)\n        .attr('src', featEntry.img ?? Constants.MYSTERY_MAN)\n        .addClass('hct-hover-shadow-accent');\n    });\n    const $raceFeaturesSection = $('section', $('[data-hct_race_area=feat]', this.$context)).empty();\n    featOption.render($raceFeaturesSection);\n    this.stepOptions.push(featOption);\n  }\n}\nconst RaceTab: Step = new _Race();\nexport default RaceTab;\n\nfunction getSizeOptions(): KeyValue[] {\n  const foundrySizes = (game as any).dnd5e.config.actorSizes;\n\n  return Object.keys(foundrySizes).map((k) => ({ key: k, value: foundrySizes[k] }));\n}\n\nfunction validSubraceName(name: string, misleadingFeatureNames: string[]): boolean {\n  return !misleadingFeatureNames.includes(name);\n}\n\nfunction subraceNameIsPartOfRaceName(subraceName: string, parentName: string): boolean {\n  if (parentName.includes(' ')) {\n    return subraceName.includes(parentName);\n  } else {\n    return subraceName.includes(' ') ? subraceName.split(' ').includes(parentName) : subraceName.includes(parentName);\n  }\n}\n\nfunction parentListedAsRequirement(subrace: RaceEntry, parentName: string): boolean {\n  return parentName.includes(subrace.data.requirements);\n}\n\nfunction getPickableRaces(raceEntries: RaceEntry[], misleadingFeatureNames: string[]): IndexEntry[] {\n  const pickableRaces = raceEntries.filter((e) => e.data.requirements == ''); // start with parent races / races without subclasses\n\n  const notParentEntries = raceEntries.filter((e) => e.data.requirements !== '');\n  const parentsToRemove: Set<RaceEntry> = new Set(); // all classes with children are deleted at the end\n  notParentEntries.forEach((e) => {\n    if (validSubraceName(e.name, misleadingFeatureNames)) {\n      const parent = pickableRaces.find(\n        (p) => parentListedAsRequirement(e, p.name) && subraceNameIsPartOfRaceName(e.name, p.name),\n      );\n      if (parent) {\n        // if parent found, add it to the set so main races with children are later removed from the list\n        parentsToRemove.add(parent);\n        pickableRaces.push(e);\n      }\n    }\n  });\n  parentsToRemove.forEach((p) => pickableRaces.splice(pickableRaces.indexOf(p), 1));\n\n  return pickableRaces.sort((a, b) => a.name.localeCompare(b.name));\n}\n\nfunction getParentRace(selectedRace: RaceEntry, raceEntries: RaceEntry[]) {\n  if (selectedRace.data.requirements == '') return null;\n\n  return raceEntries.find((e) => e.name === selectedRace.data.requirements);\n}\n","import { StepEnum } from '../Step';\nimport { ActorDataConstructorData } from '@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs/actorData';\nimport HeroOption, { apply } from './HeroOption';\nimport * as Constants from '../constants';\nimport { IndexEntry } from '../indexUtils';\n\n/**\n * Represents a value needs to be selected by the player with a single output onto the created actor.\n * (e.g. Dwarven's Tool Proficiency is a single option between three defined ones)\n * @class\n */\nexport default class SelectableIndexEntryOption implements HeroOption {\n  constructor(\n    readonly origin: StepEnum,\n    readonly key: string,\n    readonly options: IndexEntry[],\n    readonly settings: {\n      addValues: boolean;\n      placeholderName?: string;\n    } = { addValues: false },\n  ) {\n    this.optionsMap = new Map(\n      options.map((i) => [i.name === this.settings.placeholderName ? '' : foundry.utils.randomID(), i]),\n    );\n  }\n\n  optionsMap: Map<string, IndexEntry>;\n\n  isFulfilled() {\n    return !!this.value();\n  }\n\n  applyToHero(actor: ActorDataConstructorData) {\n    apply(actor, this.key, [this.value()], this.settings.addValues);\n  }\n\n  $itemImg!: JQuery;\n  $select!: JQuery;\n  $link!: JQuery;\n\n  render($parent: JQuery): void {\n    const $container = $('<div class=\"hct-icon-with-context\">');\n    this.$link = $(`<a class=\"content-link hct-icon-link\" draggable=\"false\" data-pack=\"\" data-id=\"\">`);\n    this.$itemImg = $('<img class=\"hct-icon hct-hover-shadow-accent\">');\n    this.$select = $(`<select class=\"hct-overflow-ellipsis hct-width-195\">`);\n\n    this.$link.append(this.$itemImg);\n    $container.append(this.$link);\n    this.optionsMap.forEach((item, key) => {\n      const placeholder = item.name === this.settings.placeholderName ? 'selected disabled' : '';\n      const $opt = $(`<option class=\"hct-overflow-ellipsis\" value=\"${key}\" ${placeholder}>${item.name}</option>`);\n      this.$select.append($opt);\n    });\n    this.$select.on('change', () => {\n      const val = this.$select.val();\n      const item = this.optionsMap.get((val as string) ?? '')!;\n      this.$itemImg.attr('src', item.img || Constants.MYSTERY_MAN);\n      this.$link.attr('data-pack', item._pack);\n      this.$link.attr('data-id', item._id);\n    });\n    $container.append(this.$select);\n    $parent.append($container);\n    this.$select.trigger('change');\n  }\n\n  value(): any {\n    const val = this.$select.val() ?? '';\n    return this.optionsMap.get(val as string);\n  }\n}\n","import * as Utils from './utils';\nimport SettingKeys from './settings';\nimport { HpCalculation } from './constants';\nimport { ClassLevel } from './ClassLevel';\n\nexport class HitDie {\n  constructor(private hd: string) {}\n\n  getVal() {\n    return `1${this.hd}`;\n  }\n\n  getMax(): number {\n    return parseInt(this.hd.substring(1));\n  }\n\n  getAvg(): number {\n    const half = Math.ceil(this.getMax() / 2);\n    return half + 1;\n  }\n\n  async calculateHpAtLevel(level: ClassLevel, method: HpCalculation, conMod: number) {\n    const firstLevelHp = this.getMax() + conMod;\n    if (level === 1) return firstLevelHp;\n\n    let higherLevelHp = 0;\n    if (method === 'avg') {\n      higherLevelHp = (this.getAvg() + conMod) * (level - 1);\n    } else {\n      // roll\n      for (let l = 2; l <= level; l++) {\n        const roll = await new Roll(`${this.getVal()} + ${conMod}`).evaluate({ async: true });\n        if (Utils.getModuleSetting(SettingKeys.SHOW_ROLLS_AS_MESSAGES)) {\n          roll.toMessage({ flavor: game.i18n.format('HCT.Class.HpRollChatFlavor', { lv: l }) });\n        }\n        higherLevelHp += parseInt(roll.result) + conMod;\n      }\n    }\n    return firstLevelHp + higherLevelHp;\n  }\n}\n","/*\n  Functions used exclusively on the Class tab\n*/\nimport { Step, StepEnum } from '../Step';\nimport * as CONSTANTS from '../constants';\nimport * as Utils from '../utils';\nimport * as ProficiencyUtils from '../proficiencyUtils';\nimport HiddenOption from '../options/HiddenOption';\nimport FixedOption, { OptionType } from '../options/FixedOption';\nimport SelectableIndexEntryOption from '../options/SelectableIndexEntryOption';\nimport SearchableIndexEntryOption from '../options/SearchableIndexEntryOption';\nimport { HitDie } from '../HitDie';\nimport { ClassLevel } from '../ClassLevel';\nimport { ClassEntry, ClassFeatureEntry, getClassEntries, getClassFeatureEntries } from '../indexUtils';\nimport SettingKeys from '../settings';\n\nexport type ClassSpellcastingData = {\n  item: Item;\n  ability: string;\n  progression: string;\n};\n\nclass _Class extends Step {\n  private classes?: ClassEntry[] = [];\n  private classFeatures?: ClassFeatureEntry[] = [];\n  private _class?: ClassEntry;\n  private primaryClassLevel: ClassLevel = 1;\n  private primaryClassHitDie: HitDie | null = null;\n  constructor() {\n    super(StepEnum.Class);\n  }\n\n  spellcasting?: ClassSpellcastingData;\n\n  getUpdateData() {\n    return this._class\n      ? {\n          name: this._class.name,\n          spellcasting: this.spellcasting,\n          level: this.primaryClassLevel,\n          hitDie: this.primaryClassHitDie,\n          hpMethod: (document.querySelector('input[name=\"higher-lv-hp\"]:checked') as HTMLInputElement)?.value ?? 'avg',\n        }\n      : undefined;\n  }\n\n  section = () => $('#classDiv');\n\n  setListeners(): void {\n    // do nothing\n  }\n\n  async setSourceData() {\n    // classes\n    const classItems = await getClassEntries();\n    this.classes = classItems?.sort((a, b) => a.name.localeCompare(b.name));\n    if (!this.classes) ui.notifications!.error(game.i18n.format('HCT.Error.RenderLoad', { value: 'Classes' }));\n\n    // class features\n    const classFeatureItems = await getClassFeatureEntries();\n    this.classFeatures = classFeatureItems?.sort((a, b) => a.name.localeCompare(b.name)) as any;\n  }\n\n  private $primaryClassLevelSelect!: HTMLSelectElement;\n  renderData(): void {\n    Utils.setPanelScrolls(this.section());\n    $('[data-hct_class_data]', this.section()).hide();\n\n    const searchableOption = new SearchableIndexEntryOption(\n      this.step,\n      'item',\n      this.classes!,\n      (classId) => {\n        // callback on selected\n        this.clearOptions();\n        this._class = this.classes!.find((c) => c._id === classId);\n        if (!this._class) {\n          throw new Error(`Error finding class with name ${classId}`);\n        }\n        if (this.classes) {\n          this.updateClass(this.section());\n          this.$primaryClassLevelSelect.disabled = false;\n        } else ui.notifications!.error(game.i18n.format('HCT.Error.UpdateValueLoad', { value: 'Classes' }));\n      },\n      game.i18n.localize('HCT.Class.Select.Default'),\n    );\n    const $classSearch = $('[data-hct-class-search]');\n    searchableOption.render($classSearch, { prepend: true });\n    this.$primaryClassLevelSelect = addLevelSelect($classSearch, 'class');\n    this.$primaryClassLevelSelect.disabled = true;\n    this.$primaryClassLevelSelect.addEventListener('change', (event) => {\n      this.primaryClassLevel = parseInt((event.target as any)?.value) as ClassLevel;\n      this.updateClass(this.section());\n    });\n  }\n\n  updateClass($section: JQuery) {\n    const $context = $('[data-hct_class_data]', $section);\n    this.clearOptions();\n\n    // icon, description and class item\n    $('[data-hct_class_icon]', $section).attr('src', this._class?.img || CONSTANTS.MYSTERY_MAN);\n    $('[data-hct_class_description]', $section).html(\n      TextEditor.enrichHTML(this._class?.data?.description?.value ?? ''),\n    );\n    if (!this._class) {\n      throw new Error(`Error finding current class`);\n    }\n    this._class.data.levels = this.primaryClassLevel;\n    this.stepOptions.push(new HiddenOption(ClassTab.step, 'items', [this._class], { addValues: true }));\n\n    this.setHitPointsUi($context);\n    this.setSavingThrowsUi($context);\n    this.setProficienciesUi($context);\n    this.setClassFeaturesUi($context);\n\n    this.setSpellcastingAbilityIfExisting();\n\n    $('[data-hct_class_data]').show();\n    return;\n  }\n\n  private setSpellcastingAbilityIfExisting() {\n    const spellCastingAbility = (this._class?.data as any)?.spellcasting?.ability;\n    if (spellCastingAbility) {\n      this.stepOptions.push(\n        new FixedOption(StepEnum.Spells, 'data.attributes.spellcasting', spellCastingAbility, '', {\n          addValues: false,\n          type: OptionType.TEXT,\n        }),\n      );\n    }\n  }\n\n  private async setProficienciesUi($context: JQuery<HTMLElement>) {\n    const $proficiencySection: JQuery = $('section', $('[data-hct_class_area=proficiencies]', $context)).empty();\n    const foundrySkills = (game as any).dnd5e.config.skills;\n    const options = [];\n\n    options.push(\n      ProficiencyUtils.prepareSkillOptions({\n        step: this.step,\n        $parent: $proficiencySection,\n        pushTo: this.stepOptions,\n        filteredOptions: this._class!.data.skills.choices.map((s: string) => ({\n          key: s,\n          value: foundrySkills[s],\n        })),\n        quantity: this._class!.data.skills.number,\n        addValues: true,\n        expandable: false,\n        customizable: false,\n      }),\n    );\n\n    options.push(\n      await ProficiencyUtils.prepareWeaponOptions({\n        step: this.step,\n        $parent: $proficiencySection,\n        pushTo: this.stepOptions,\n        quantity: 0,\n        addValues: true,\n        expandable: true,\n        customizable: true,\n      }),\n    );\n\n    options.push(\n      await ProficiencyUtils.prepareArmorOptions({\n        step: this.step,\n        $parent: $proficiencySection,\n        pushTo: this.stepOptions,\n        quantity: 0,\n        addValues: true,\n        expandable: true,\n        customizable: true,\n      }),\n    );\n\n    options.push(\n      await ProficiencyUtils.prepareToolOptions({\n        step: this.step,\n        $parent: $proficiencySection,\n        pushTo: this.stepOptions,\n        quantity: 0,\n        addValues: true,\n        expandable: true,\n        customizable: true,\n      }),\n    );\n\n    options.push(\n      ProficiencyUtils.prepareLanguageOptions({\n        step: this.step,\n        $parent: $proficiencySection,\n        pushTo: this.stepOptions,\n        quantity: 0,\n        addValues: true,\n        expandable: true,\n        customizable: true,\n      }),\n    );\n\n    options.forEach((o) => o.render($proficiencySection));\n    this.stepOptions.push(...options);\n  }\n\n  private async setClassFeaturesUi($context: JQuery<HTMLElement>) {\n    const $featuresSection = $('section', $('[data-hct_class_area=features]', $context)).empty();\n    let classFeatures = Utils.filterItemList({\n      filterValues: [...Array(this.primaryClassLevel).keys()].map((k) => `${this._class!.name} ${k + 1}`),\n      filterField: 'data.requirements',\n      itemList: this.classFeatures!,\n    }).sort((a, b) => {\n      const lvA = parseInt(a.data.requirements.substring(a.data.requirements.indexOf(' ')));\n      const lvB = parseInt(b.data.requirements.substring(b.data.requirements.indexOf(' ')));\n      return lvA - lvB;\n    });\n    // handle fighting style\n    const fsString = Utils.getModuleSetting(SettingKeys.FIGHTING_STYLE_STRING) as string;\n    const fightingStyles = classFeatures.filter((i) => (i as any).name.startsWith(fsString));\n    classFeatures = classFeatures.filter((i) => !(i as any).name.startsWith(fsString));\n\n    const spellcastingItem = classFeatures.find(\n      (i) => (i as any).name.startsWith('Spellcasting') || (i as any).name.startsWith('Pact Magic'),\n    );\n    if (spellcastingItem) {\n      this.spellcasting = {\n        item: (await game.packs.get(spellcastingItem._pack)?.getDocument(spellcastingItem._id)) as Item,\n        ability: this._class!.data.spellcasting.ability,\n        progression: this._class!.data.spellcasting.progression,\n      };\n    } else {\n      this.spellcasting = undefined;\n    }\n\n    if (fightingStyles && fightingStyles.length > 0) {\n      const fsOption = new SelectableIndexEntryOption(StepEnum.Class, 'items', fightingStyles, {\n        addValues: true,\n        placeholderName: fsString,\n      });\n      fsOption.render($featuresSection);\n      this.stepOptions.push(fsOption);\n    }\n\n    classFeatures.forEach((feature) => {\n      const featureOption = new FixedOption(ClassTab.step, 'items', feature, undefined, {\n        addValues: true,\n        type: OptionType.ITEM,\n      });\n      featureOption.render($featuresSection);\n      this.stepOptions.push(featureOption);\n    });\n  }\n\n  private setSavingThrowsUi($context: JQuery<HTMLElement>) {\n    const savingThrows: string[] = (this._class as any).data.saves;\n    const foundryAbilities = (game as any).dnd5e.config.abilities;\n    const $savingThrowsSection = $('section', $('[data-hct_class_area=saving-throws]', $context)).empty();\n    savingThrows.forEach((save) => {\n      const savingThrowOption = new FixedOption(\n        ClassTab.step,\n        `data.abilities.${save}.proficient`,\n        1,\n        foundryAbilities[save],\n      );\n      savingThrowOption.render($savingThrowsSection);\n      this.stepOptions.push(savingThrowOption);\n    });\n  }\n\n  private setHitPointsUi($context: JQuery<HTMLElement>) {\n    this.primaryClassHitDie = new HitDie((this._class as any).data.hitDice);\n    $('[data-hct-class-hp-lv1]', $context).text(this.primaryClassHitDie.getMax());\n    $('[data-hct-class-hp-higher-lv]', $context).text(this.primaryClassHitDie.getVal());\n  }\n}\nconst ClassTab: Step = new _Class();\nexport default ClassTab;\n\nfunction addLevelSelect($parent: JQuery, className: string) {\n  const $select = document.createElement('select');\n  $select.setAttribute(`data-hct-${className}-level`, '');\n  for (let i = 1; i <= 20; i++) {\n    const $opt = document.createElement('option');\n    $opt.value = i + '';\n    $opt.text = game.i18n.localize(`HCT.Class.Level${i}`);\n    $select.appendChild($opt);\n  }\n  $parent.append($select);\n\n  return $select;\n}\n","import * as Constants from '../constants';\nimport { StepEnum } from '../Step';\nimport { ActorDataConstructorData } from '@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs/actorData';\nimport HeroOption, { apply } from './HeroOption';\nimport { ItemDataConstructorData } from '@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs/itemData';\nimport { IndexEntry } from '../indexUtils';\n\nexport default class SelectOrCustomItemOption implements HeroOption {\n  constructor(\n    readonly origin: StepEnum,\n    readonly data: {\n      type: string;\n      source?: string;\n    },\n    readonly propertiesCallback: () => any,\n    readonly selectOptions?: IndexEntry[],\n    readonly settings: {\n      allowNulls?: boolean;\n      addValues: boolean;\n    } = { addValues: true },\n  ) {}\n\n  readonly key: string = 'items';\n  readonly CUSTOM = 'custom';\n\n  private $select!: JQuery;\n  private $link!: JQuery;\n  private $icon!: JQuery;\n  private $customInputs!: JQuery;\n  private $customName!: JQuery;\n  private $customDescription!: JQuery;\n\n  private isCustom = false;\n  private item: IndexEntry | undefined;\n\n  isFulfilled() {\n    return !!this.$customName.val() && !!this.$customDescription.val();\n  }\n\n  async applyToHero(actor: ActorDataConstructorData) {\n    if (this.$select.val()) {\n      const itemToAdd = this.item ? this.item : await this.buildItem();\n      apply(actor, this.key, [itemToAdd], this.settings.addValues);\n    }\n  }\n\n  /**\n   * Builds the HTML element for this option and appends it to the parent\n   * @param {JQuery} parent\n   */\n  render(parent: JQuery): void {\n    const $container = $('<div>');\n    const $iconAndSelect = $(`<div class=\"hct-icon-with-context hct-margin-b-tiny\">`);\n\n    this.$link = $(`<a class=\"hct-icon-link\" draggable=\"false\" data-pack=\"\" data-id=\"\">`);\n    this.$icon = $(`<img class=\"hct-icon hct-icon-clickable\" src=\"${Constants.MYSTERY_MAN}\">`);\n    this.$icon.on('click', () => {\n      if (this.isCustom) this.openFilePicker();\n    });\n    this.$link.append(this.$icon);\n    $iconAndSelect.append(this.$link);\n\n    this.$select = $(`<select class=\"hct-option-select hct-margin-l-tiny\">`)\n      .append(\n        $(`<option value=\"\" selected ${this.settings.allowNulls ? '' : 'hidden disabled'}>\n      ${game.i18n.localize('HCT.Common.SelectPlaceholder')}\n      </option>`),\n      )\n      .append(\n        $(`<option value=\"${this.CUSTOM}\">\n      ${game.i18n.localize('HCT.Common.SelectCreateOne')}\n      </option>`),\n      );\n    if (this.selectOptions) {\n      this.$select.append(\n        this.selectOptions.map((option: IndexEntry, index: number) =>\n          $(`<option value=\"${index}\">${option.name}</option>`),\n        ),\n      );\n    }\n    this.$select.on('change', () => {\n      this.isCustom = this.CUSTOM === this.$select.val();\n      if (!this.$select.val()) {\n        // selected Choose again\n        this.$icon.removeClass('hct-hover-shadow-accent');\n        this.$icon.attr('src', Constants.MYSTERY_MAN);\n        this.$link.removeClass('content-link');\n        this.item = undefined;\n        this.$customInputs.hide();\n        return;\n      }\n      this.$icon.addClass('hct-hover-shadow-accent');\n      if (this.isCustom) {\n        this.$link.removeClass('content-link');\n        this.$customDescription.text('');\n        this.$customName.text('');\n        this.item = undefined;\n        this.$icon.attr('src', Constants.MYSTERY_MAN);\n        this.$customInputs.show();\n      } else {\n        this.$customInputs.hide();\n        const index = parseInt(this.$select.val() as string);\n        this.item = this.selectOptions![index];\n        this.$icon.attr('src', this.item.img || Constants.MYSTERY_MAN);\n        this.$link.attr('data-pack', this.item._pack);\n        this.$link.attr('data-id', this.item._id);\n        this.$link.addClass('content-link');\n      }\n    });\n    $iconAndSelect.append(this.$select);\n    $container.append($iconAndSelect);\n\n    this.$customInputs = $('<div data-hct_custom_item_inputs>');\n    const $nameDiv = $(\"<div class='hct-margin-b-tiny'>\");\n    this.$customName = $(`<input type=\"text\" placeholder=\"${game.i18n.localize('HCT.Common.RequiredName')}\">`);\n    $nameDiv.append(this.$customName);\n    this.$customDescription = $(`<textarea type=\"text\" placeholder=\"${game.i18n.localize('HCT.Common.Desc')}\">`);\n    this.$customInputs.append($nameDiv);\n    this.$customInputs.append(this.$customDescription);\n    this.$customInputs.hide(); // hide by default\n    $container.append(this.$customInputs);\n\n    parent.append($container);\n  }\n\n  /**\n   * Unused for CustomItemOption\n   */\n  value(): void {\n    return;\n  }\n\n  async buildItem() {\n    // fetch name, description and icon and create an item to return\n    let itemDataConstructorData: ItemDataConstructorData;\n    const callbackProperties = this.propertiesCallback();\n    if (!this.$customName.val()) {\n      ui.notifications?.error(game.i18n.format('HCT.Error.CustomItemWithoutName', { origin: this.origin }));\n      throw new Error('Trying to create feature without name');\n    }\n\n    try {\n      const featureName = this.$customName.val() as string;\n      const featureDesc = this.$customDescription.val() as string;\n      const featureIcon = this.$icon.attr('src') as string;\n      if (!featureName || !featureName.trim()) {\n        if (featureDesc || (featureIcon && featureIcon !== Constants.MYSTERY_MAN)) {\n          ui.notifications?.error(game.i18n.format('HCT.Error.CustomItemWithoutName', { origin: this.origin }));\n          return;\n        }\n      }\n      itemDataConstructorData = {\n        name: featureName,\n        type: this.data.type,\n        img: featureIcon,\n        data: {\n          description: {\n            value: featureDesc,\n          },\n          requirements: callbackProperties.requirements || '',\n          source: this.data.source || '',\n        },\n      };\n      const item = await Item.create(itemDataConstructorData /*, { temporary: true }*/);\n      return { ...item?.toObject(), custom: true };\n    } catch (error) {\n      console.warn('Error trying to create custom item');\n      console.error(error);\n      console.warn(`name.val: [${this.$customName.val()}]`);\n      console.warn(`desc.val: [${this.$customDescription.val()}]`);\n      console.warn('itemData: ');\n      console.warn(itemDataConstructorData!);\n    }\n  }\n\n  openFilePicker() {\n    const path1 = '/';\n    const fp2 = new FilePicker({\n      type: 'image',\n      current: path1,\n      callback: (path: string) => {\n        this.$icon.attr('src', path);\n      },\n    } as any);\n    fp2.browse();\n  }\n}\n","/*\n  Functions used exclusively on the Background tab\n*/\nimport * as Utils from '../utils';\nimport * as Constants from '../constants';\nimport * as ProficiencyUtils from '../proficiencyUtils';\nimport { Step, StepEnum } from '../Step';\nimport SelectableOption from '../options/SelectableOption';\nimport SelectOrCustomItemOption from '../options/SelectOrCustomItemOption';\nimport { BackgroundFeatureEntry, getBackgroundFeatureEntries, getRuleJournalEntryByName } from '../indexUtils';\n\nclass _BackgroundTab extends Step {\n  constructor() {\n    super(StepEnum.Background);\n  }\n\n  section = () => $('#backgroundDiv');\n\n  backgroundFeatures!: BackgroundFeatureEntry[];\n\n  async setSourceData() {\n    this.backgroundFeatures = await getBackgroundFeatureEntries();\n  }\n\n  async renderData() {\n    Utils.setPanelScrolls(this.section());\n    // Show rules on the side panel\n    const rulesCompendiumName = game.i18n.localize('HCT.Background.RulesJournalName');\n    const backgroundRules = await getRuleJournalEntryByName(rulesCompendiumName);\n    if (backgroundRules) {\n      $('[data-hct_background_description]', this.section()).html(TextEditor.enrichHTML(backgroundRules.content));\n    } else {\n      console.error(`Unable to find backgrounds' rule journal on compendium ${rulesCompendiumName}`);\n    }\n\n    this.setBackgroundNameUi();\n    this.setAlignmentUi();\n    this.setProficienciesUi();\n    this.setBackgroundFeatureUi();\n  }\n\n  private async setProficienciesUi() {\n    const $proficienciesArea = $('[data-hct_area=proficiences]', this.section());\n    const options = [];\n    options.push(\n      ProficiencyUtils.prepareSkillOptions({\n        step: this.step,\n        $parent: $proficienciesArea,\n        pushTo: this.stepOptions,\n        quantity: 2,\n        addValues: true,\n        expandable: true,\n        customizable: false,\n      }),\n    );\n    options.push(\n      await ProficiencyUtils.prepareToolOptions({\n        step: this.step,\n        $parent: $proficienciesArea,\n        pushTo: this.stepOptions,\n        quantity: 0,\n        addValues: true,\n        expandable: true,\n        customizable: true,\n      }),\n    );\n    options.push(\n      ProficiencyUtils.prepareLanguageOptions({\n        step: this.step,\n        $parent: $proficienciesArea,\n        pushTo: this.stepOptions,\n        quantity: 0,\n        addValues: true,\n        expandable: true,\n        customizable: true,\n      }),\n    );\n\n    options.forEach((o) => o.render($proficienciesArea));\n    this.stepOptions.push(...options);\n  }\n\n  private setBackgroundFeatureUi() {\n    const $featureArea = $('[data-hct_area=feature]', this.section());\n    const customFeatureOption: SelectOrCustomItemOption = new SelectOrCustomItemOption(\n      this.step,\n      { type: 'feat', source: 'Background' },\n      () => {\n        // properties callback\n        const $name = $('input', $('[data-hct_area=name]', this.section()));\n        return { requirements: $name.val() };\n      },\n      this.backgroundFeatures,\n      {\n        addValues: true,\n        allowNulls: true,\n      },\n    );\n    customFeatureOption.render($featureArea);\n    this.stepOptions.push(customFeatureOption);\n  }\n\n  private setAlignmentUi() {\n    const foundryAligments = (game as any).dnd5e.config.alignments;\n    const alignmentChoices = Object.keys(foundryAligments).map((k) => ({\n      key: foundryAligments[k],\n      value: foundryAligments[k],\n    }));\n    const alignmentOption = new SelectableOption(this.step, 'data.details.alignment', alignmentChoices, '', {\n      addValues: false,\n      customizable: false,\n    });\n    alignmentOption.render($('[data-hct_area=alignment]', this.section()));\n    this.stepOptions.push(alignmentOption);\n  }\n\n  private setBackgroundNameUi() {\n    const nameChoices = this.backgroundFeatures\n      .filter((f) => f.data.requirements)\n      .map((f) => ({ key: f.data.requirements, value: f.data.requirements }));\n    const nameOption = new SelectableOption(\n      StepEnum.Background,\n      'data.details.background',\n      nameChoices,\n      '',\n      { addValues: false, customizable: true },\n      this.onBackgroundSelect,\n      new Map(this.backgroundFeatures.map((obj) => [(obj.data as any).requirements, obj.name!])),\n    );\n    nameOption.render($('[data-hct_area=name]', this.section()));\n    this.stepOptions.push(nameOption);\n  }\n\n  private onBackgroundSelect(backgroundFeatureName: string) {\n    const $featureArea = $('[data-hct_area=feature]', $('#backgroundDiv'));\n    const $select = $('select', $featureArea);\n    const $img = $('img', $featureArea);\n    const $name = $('input', $featureArea);\n    const $desc = $('textarea', $featureArea);\n    let isCustomTouched = false;\n    if ($name.val() != '' || $desc.val() != '') isCustomTouched = true;\n\n    if (!isCustomTouched) {\n      if (backgroundFeatureName === 'custom') {\n        $('option:selected', $select).prop('selected', false);\n        $(\"option[value='']\", $select).prop('selected', 'true');\n        $img.attr('src', Constants.MYSTERY_MAN);\n        return;\n      }\n      const value = $('option', $select)\n        .filter(function () {\n          return $(this).text() === backgroundFeatureName;\n        })\n        .first()\n        .attr('value');\n      if (value) {\n        $select.val(value);\n        $select.trigger('change');\n      }\n    }\n  }\n}\nconst BackgroundTab: Step = new _BackgroundTab();\nexport default BackgroundTab;\n","import { StepEnum } from '../Step';\nimport { ActorDataConstructorData } from '@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs/actorData';\nimport HeroOption from './HeroOption';\n\n/**\n * Represents a fixed value that will be imprinted into the created actor\n * (e.g. how all Elves get Perception proficiency)\n * @class\n */\nexport default class OptionContainer implements HeroOption {\n  constructor(\n    readonly origin: StepEnum,\n    readonly key: string,\n    private options: HeroOption[],\n    private label?: string,\n    private detail?: string,\n    readonly settings: {\n      addValues: boolean;\n      deletable?: boolean;\n    } = { addValues: false },\n    readonly deleteCallback?: (args?: any) => any,\n    readonly callbackParams?: string,\n  ) {}\n\n  isFulfilled() {\n    return this.options.every((o) => o.isFulfilled());\n  }\n\n  applyToHero(actor: ActorDataConstructorData) {\n    this.options.forEach((o) => o.applyToHero(actor));\n  }\n\n  render($parent: JQuery): void {\n    const $container = $(\n      `<fieldset class=\"hct-option-container\" ${\n        this.settings.deletable ? 'id=\"hct_deletable_' + this.callbackParams + '\"' : ''\n      }>`,\n    );\n    const $legend = $(\n      `<legend class=\"hct-option-container-legend\">${this.label || ''}${\n        this.detail ? ' (' + this.detail + ')' : ''\n      }</legend>`,\n    );\n    $container.append($legend);\n    if (this.settings.deletable && this.deleteCallback) {\n      const $deleteButton = $(\n        `<button class=\"hct-no-border hct-no-background hct-width-fit hct-hover-no-shadow hct-hover-accent\"><i class=\"fas fa-trash\"></i></button>`,\n      );\n      $deleteButton.on('click', () => {\n        this.deleteCallback!(this);\n      });\n      $legend.append($deleteButton);\n    }\n    this.options.forEach((o) => o.render($container));\n    $parent.append($container);\n  }\n\n  /**\n   * @returns the current value of this option\n   */\n  value(): any[] {\n    return this.options.map((o) => o.value());\n  }\n}\n","import { StepEnum } from '../Step';\nimport { ActorDataConstructorData } from '@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs/actorData';\nimport HeroOption, { apply } from './HeroOption';\nimport { EquipmentEntry } from '../indexUtils';\n\n/**\n * Represents a value with a selectable quantity that will be imprinted into the created actor\n * @class\n */\nexport default class QuantifiableOption implements HeroOption {\n  constructor(\n    readonly origin: StepEnum,\n    private itemOption: EquipmentEntry,\n    readonly settings: {\n      addValues: boolean;\n      quantity: number;\n      canChangeQuantity: boolean;\n      showTotalCost: boolean;\n      price?: number;\n      id?: string;\n      changeCallback?: (id: string, newQuantity: number) => any;\n    } = { addValues: true, quantity: 1, canChangeQuantity: false, showTotalCost: false },\n  ) {}\n  key = 'items';\n\n  isFulfilled() {\n    return !!this.itemOption;\n  }\n\n  applyToHero(actor: ActorDataConstructorData) {\n    this.itemOption.data.quantity = this.settings.quantity;\n    apply(actor, this.key, [this.itemOption], this.settings.addValues, false);\n  }\n\n  private $up = $(\n    `<button class=\"hct-button--floating hct-button-up\"><i class=\"hct-margin-0 fas fa-angle-up\" class=\"hct-padding-tiny\"></i></button>`,\n  );\n  private $down = $(\n    '<button class=\"hct-button--floating hct-button-down\"><i class=\"hct-margin-0 fas fa-angle-down\" class=\"hct-padding-tiny\"></i></button>',\n  );\n  private $text = $(buildText(this.itemOption, this.settings.quantity, this.settings.showTotalCost));\n\n  render(parent: JQuery): void {\n    const $container = $('<div class=\"hct-icon-with-context hct-padding-b-tiny hct-flex-grow-1\">');\n    const $link = $(\n      `<a class=\"content-link hct-icon-link hct-flex\" draggable=\"false\" data-pack=\"${this.itemOption._pack}\" data-id=\"${this.itemOption._id}\">`,\n    );\n    const $itemImg = $('<img class=\"hct-icon hct-hover-shadow-accent\">').attr('src', this.itemOption.img);\n    $link.append($itemImg);\n    $container.append($link);\n    $container.append(this.$text);\n\n    if (this.settings.canChangeQuantity) {\n      const $buttons = $(`<div class='hct-quantity-buttons'>`);\n      $buttons.append(this.$up);\n      $buttons.append(this.$down);\n      $container.append($buttons);\n\n      this.$up.on('click', (ev) => {\n        if (ev.ctrlKey) {\n          this.settings.quantity += 5;\n        } else {\n          this.settings.quantity++;\n        }\n        this.settings.changeCallback!(this.settings.id!, this.settings.quantity * this.settings.price!);\n        this.$text.html(buildText(this.itemOption, this.settings.quantity, this.settings.showTotalCost));\n      });\n      this.$down.on('click', (ev) => {\n        if (this.settings.quantity > 1) {\n          if (ev.ctrlKey) {\n            this.settings.quantity > 6 ? (this.settings.quantity -= 5) : (this.settings.quantity = 1);\n          } else {\n            this.settings.quantity--;\n          }\n          this.settings.changeCallback!(this.settings.id!, this.settings.quantity * this.settings.price!);\n          this.$text.html(buildText(this.itemOption, this.settings.quantity, this.settings.showTotalCost));\n        }\n      });\n    }\n\n    parent.append($container);\n  }\n\n  /**\n   * @returns the current value of this option\n   */\n  value(): any {\n    return this.itemOption;\n  }\n}\n\nfunction buildText(itemOption: any, quantity: number, showTotal: boolean) {\n  if (showTotal) {\n    const totalPrice = Math.round((itemOption.data.price * quantity + Number.EPSILON) * 100) / 100;\n    return `<p class=\"hct-flex-grow-1\">${itemOption.name} x${quantity} (${totalPrice}gp)</p>`;\n  } else {\n    return `<p class=\"hct-flex-grow-1\">${itemOption.name} x${quantity}</p>`;\n  }\n}\n","import * as Utils from '../utils';\nimport * as Constants from '../constants';\nimport { Step, StepEnum } from '../Step';\nimport FixedOption from '../options/FixedOption';\nimport SettingKeys from '../settings';\nimport HeroOption from '../options/HeroOption';\nimport OptionContainer from '../options/OptionContainer';\nimport DeletableOption from '../options/DeletableOption';\nimport { EquipmentEntry, getEquipmentEntries, getRuleJournalEntryByName } from '../indexUtils';\nimport QuantifiableOption from '../options/QuantifiableOption';\n\ntype itemOrPack = {\n  itemName?: string;\n  item?: EquipmentEntry;\n};\n\nclass _Equipment extends Step {\n  constructor() {\n    super(StepEnum.Equipment);\n    this.spentMap.clear();\n  }\n\n  defaultGoldDice!: string;\n  $rollInput!: JQuery;\n  $manualGold!: JQuery;\n  $totalGold!: JQuery;\n  $remainingGold!: JQuery;\n  $extraGold!: JQuery;\n\n  section = () => $('#eqDiv');\n\n  $searchWrapper!: JQuery;\n  $inputBox!: JQuery;\n  $suggBox!: JQuery;\n  $itemList!: JQuery;\n  searchArray: EquipmentEntry[] = [];\n\n  items!: EquipmentEntry[];\n  searchableList!: EquipmentEntry[];\n\n  available = 0;\n  total = 0;\n  extra = 0;\n  spent = 0;\n\n  spentMap: Map<string, number> = new Map();\n\n  async setListeners() {\n    this.$searchWrapper = $('.hct-search-wrapper', this.section());\n    this.$inputBox = $('input', this.$searchWrapper);\n    this.$suggBox = $('[data-hct-searchbar-results]', this.$searchWrapper);\n    this.$itemList = $('[data-hct-itemlist]', this.section());\n    this.$manualGold = $('[data-hct_equipment_manual_gold]', this.section());\n    this.$extraGold = $('[data-hct_equipment_extra]', this.section());\n\n    $('[data-hct-searchbar]', this.section()).on('submit', (event) => {\n      if (this.searchArray.length == 1) {\n        try {\n          this.addItemOrPack({ item: this.searchArray[0] });\n          this.$inputBox.val('');\n        } catch (error) {\n          console.error(error);\n          return false;\n        }\n        this.$searchWrapper.removeClass('active');\n      }\n      return false;\n    });\n\n    $('[data-hct_equipment_roll]', this.section()).on('click', async (e) => {\n      const rollExpression = this.$rollInput.val() as string;\n      const roll = await new Roll(rollExpression).evaluate({ async: true });\n      if (Utils.getModuleSetting(SettingKeys.SHOW_ROLLS_AS_MESSAGES)) {\n        roll.toMessage({ flavor: game.i18n.localize('HCT.Equipment.RollChatFlavor') });\n      }\n      this.available = roll.total ?? 0;\n\n      this.$manualGold.prop('disabled', true).val('');\n      this.updateGold();\n    });\n\n    $('[data-hct_equipment_input]', this.section()).on('click', (e) => {\n      this.$manualGold.prop('disabled', false).val(0);\n      this.available = 0;\n      this.updateGold();\n    });\n\n    this.$manualGold.on('keyup', (e) => {\n      this.available = parseInt(this.$manualGold.val() as string) || 0;\n      this.updateGold();\n    });\n\n    this.$extraGold.on('keyup', (e) => {\n      this.extra = parseInt(this.$extraGold.val() as string) || 0;\n      this.updateGold();\n    });\n\n    $('[data-hct_equipment_clear]', this.section()).on('click', () => {\n      this.clearOptions();\n      this.$itemList.empty();\n      this.spent = 0;\n      this.spentMap.clear();\n      this.updateGold();\n    });\n\n    this.$inputBox.on('keyup', (e) => {\n      const userData = (e.target as any).value;\n      if (userData) {\n        this.searchArray = this.searchableList.filter((data) => {\n          return data.name.toLocaleLowerCase().includes(userData.toLocaleLowerCase());\n        });\n        this.$searchWrapper.addClass('active');\n        this.showSuggestions(this.searchArray);\n        $('div', this.$suggBox).on('click', (event) => {\n          this.select($(event.currentTarget).data('item_name'));\n        });\n      } else {\n        this.$searchWrapper.removeClass('active');\n      }\n    });\n  }\n\n  select(itemName: string) {\n    this.addItemOrPack({ itemName: itemName });\n    this.$inputBox.val('');\n    this.$searchWrapper.removeClass('active');\n  }\n\n  private addItemOrPack(itemOrPack: itemOrPack) {\n    const item = itemOrPack.item ?? this.searchableList.find((i) => i.name == itemOrPack.itemName);\n    if (!item) {\n      console.error(itemOrPack);\n      throw new Error(`Item for item/pack not found`);\n    }\n    if (isPack(item)) {\n      this.addPackToSelection(item.name as PackNames);\n    } else {\n      const id = foundry.utils.randomID();\n      this.addItemOptionToSelection(id, this.makeItemOption(id, item, 1, true, true, true), item.data.price, 1);\n    }\n  }\n\n  showSuggestions(list: EquipmentEntry[]) {\n    let listData;\n    if (!list.length) {\n      listData = `<li>${'No matches'}</li>`;\n    } else {\n      listData = list\n        .map(\n          (item) =>\n            `<li><div class=\"hct-icon-with-context\" data-item_name=\\\"${item.name}\\\"><img class=\"hct-icon-square-med hct-background-black hct-no-border\" src=\"${item.img}\"><span>${item.name} (${item.data.price}gp)</span></div></li>`,\n        )\n        .join('');\n    }\n    this.$suggBox.html(listData);\n  }\n\n  addPackToSelection(packName: PackNames) {\n    const options = [];\n    const id = foundry.utils.randomID();\n    switch (packName) {\n      case PackNames.BURGLAR:\n        this.items\n          .filter((item) => {\n            const itemsInPack = [\n              'Backpack',\n              'Ball Bearings',\n              'Bell',\n              'Crowbar',\n              'Hammer',\n              'Hooded Lantern',\n              'Tinderbox',\n              'Waterskin',\n              'Hempen Rope (50 ft.)',\n            ];\n            return itemsInPack.includes(item.name!);\n          })\n          .forEach((item) => options.push(this.makeItemOption('', item, 1, false)));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Candle')!, 5, false));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Piton')!, 10, false));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Oil Flask')!, 2, false));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Rations')!, 5, false));\n\n        this.addItemOptionToSelection(\n          id,\n          new OptionContainer(\n            StepEnum.Equipment,\n            'items',\n            options,\n            PackNames.BURGLAR,\n            PackPrices.BURGLAR + 'gp',\n            { addValues: true, deletable: true },\n            (opt: DeletableOption) => this.onDelete(opt),\n            id,\n          ),\n          PackPrices.BURGLAR,\n          1,\n        );\n        break;\n\n      case PackNames.DIPLOMAT:\n        this.items\n          .filter((item) => {\n            const itemsInPack = [\n              'Chest',\n              'Fine Clothes',\n              'Ink Bottle',\n              'Ink Pen',\n              'Lamp',\n              'Perfume',\n              'Sealing Wax',\n              'Soap',\n            ];\n            return itemsInPack.includes(item.name!);\n          })\n          .forEach((item) => options.push(this.makeItemOption('', item, 1, false)));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Map or Scroll Case')!, 2, false));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Oil Flask')!, 2, false));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Paper')!, 5, false));\n\n        this.addItemOptionToSelection(\n          id,\n          new OptionContainer(\n            StepEnum.Equipment,\n            'items',\n            options,\n            PackNames.DIPLOMAT,\n            PackPrices.DIPLOMAT + 'gp',\n            { addValues: true, deletable: true },\n            (opt: DeletableOption) => this.onDelete(opt),\n            id,\n          ),\n          PackPrices.DIPLOMAT,\n          1,\n        );\n        break;\n\n      case PackNames.DUNGEONEER:\n        this.items\n          .filter((item) => {\n            const itemsInPack = ['Backpack', 'Crowbar', 'Hammer', 'Tinderbox', 'Waterskin', 'Hempen Rope (50 ft.)'];\n            return itemsInPack.includes(item.name!);\n          })\n          .forEach((item) => options.push(this.makeItemOption('', item, 1, false)));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Piton')!, 10, false));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Torch')!, 10, false));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Rations')!, 10, false));\n        this.addItemOptionToSelection(\n          id,\n          new OptionContainer(\n            StepEnum.Equipment,\n            'items',\n            options,\n            PackNames.DUNGEONEER,\n            PackPrices.DUNGEONEER + 'gp',\n            { addValues: true, deletable: true },\n            (opt: DeletableOption) => this.onDelete(opt),\n            id,\n          ),\n          PackPrices.DUNGEONEER,\n          1,\n        );\n        break;\n\n      case PackNames.ENTERTAINER:\n        this.items\n          .filter((item) => {\n            const itemsInPack = ['Backpack', 'Bedroll', 'Waterskin', 'Disguise Kit'];\n            return itemsInPack.includes(item.name!);\n          })\n          .forEach((item) => options.push(this.makeItemOption('', item, 1, false)));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Costume Clothes')!, 2, false));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Candle')!, 5, false));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Rations')!, 5, false));\n        this.addItemOptionToSelection(\n          id,\n          new OptionContainer(\n            StepEnum.Equipment,\n            'items',\n            options,\n            PackNames.ENTERTAINER,\n            PackPrices.ENTERTAINER + 'gp',\n            { addValues: true, deletable: true },\n            (opt: DeletableOption) => this.onDelete(opt),\n            id,\n          ),\n          PackPrices.ENTERTAINER,\n          1,\n        );\n        break;\n\n      case PackNames.EXPLORER:\n        this.items\n          .filter((item) => {\n            const itemsInPack = ['Backpack', 'Bedroll', 'Mess Kit', 'Tinderbox', 'Waterskin', 'Hempen Rope (50 ft.)'];\n            return itemsInPack.includes(item.name!);\n          })\n          .forEach((item) => options.push(this.makeItemOption('', item, 1, false)));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Torch')!, 10, false));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Rations')!, 10, false));\n        this.addItemOptionToSelection(\n          id,\n          new OptionContainer(\n            StepEnum.Equipment,\n            'items',\n            options,\n            PackNames.EXPLORER,\n            PackPrices.EXPLORER + 'gp',\n            { addValues: true, deletable: true },\n            (opt: DeletableOption) => this.onDelete(opt),\n            id,\n          ),\n          PackPrices.EXPLORER,\n          1,\n        );\n        break;\n\n      case PackNames.PRIEST:\n        this.items\n          .filter((item) => {\n            const itemsInPack = ['Backpack', 'Blanket', 'Tinderbox', 'Alms Box', 'Censer', 'Vestments', 'Waterskin'];\n            return itemsInPack.includes(item.name!);\n          })\n          .forEach((item) => options.push(this.makeItemOption('', item, 1, false)));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Candle')!, 10, false));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Block of Incense')!, 2, false));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Rations')!, 2, false));\n        this.addItemOptionToSelection(\n          id,\n          new OptionContainer(\n            StepEnum.Equipment,\n            'items',\n            options,\n            PackNames.PRIEST,\n            PackPrices.PRIEST + 'gp',\n            { addValues: true, deletable: true },\n            (opt: DeletableOption) => this.onDelete(opt),\n            id,\n          ),\n          PackPrices.PRIEST,\n          1,\n        );\n        break;\n\n      case PackNames.SCHOLAR:\n        this.items\n          .filter((item) => {\n            const itemsInPack = ['Backpack', 'Book of Lore', 'Ink Bottle', 'Ink Pen', 'Bag of Sand', 'Small Knife'];\n            return itemsInPack.includes(item.name!);\n          })\n          .forEach((item) => options.push(this.makeItemOption('', item, 1, false)));\n        options.push(this.makeItemOption('', this.items.find((i) => i.name == 'Parchment')!, 10, false));\n        this.addItemOptionToSelection(\n          id,\n          new OptionContainer(\n            StepEnum.Equipment,\n            'items',\n            options,\n            PackNames.SCHOLAR,\n            PackPrices.SCHOLAR + 'gp',\n            { addValues: true, deletable: true },\n            (opt: DeletableOption) => this.onDelete(opt),\n            id,\n          ),\n          PackPrices.SCHOLAR,\n          1,\n        );\n        break;\n    }\n  }\n\n  onDelete(option: DeletableOption) {\n    this.stepOptions.splice(this.stepOptions.indexOf(option), 1);\n    const deletableId = option.callbackParams;\n    $(`#hct_deletable_${deletableId}`, this.$itemList).remove();\n    this.spentMap.delete(deletableId);\n    this.updateGold();\n  }\n\n  makeItemOption(\n    id: string,\n    item: EquipmentEntry,\n    quantity = 1,\n    deletable = true,\n    canChangeQuantity = false,\n    showTotalCost = false,\n  ): HeroOption {\n    const option = new QuantifiableOption(StepEnum.Equipment, item, {\n      addValues: true,\n      quantity: quantity ?? 1,\n      price: item.data.price,\n      id: id,\n      canChangeQuantity: canChangeQuantity,\n      showTotalCost: showTotalCost,\n      changeCallback: (id, num) => {\n        this.spentMap.set(id, num);\n        this.updateGold();\n      },\n    });\n    if (deletable) {\n      return new DeletableOption(\n        StepEnum.Equipment,\n        option,\n        { addValues: true },\n        (args?: any) => this.onDelete(args),\n        id,\n        true,\n      );\n    } else {\n      return option;\n    }\n  }\n\n  addItemOptionToSelection(id: string, itemOption: HeroOption, cost: number, quantity = 1) {\n    this.spentMap.set(id, cost * quantity);\n    itemOption.render(this.$itemList);\n    this.stepOptions.push(itemOption);\n    this.updateGold();\n  }\n\n  updateGold() {\n    this.spent = Array.from(this.spentMap.values()).reduce((previousValue, currentValue) => {\n      return currentValue + previousValue;\n    }, 0);\n    this.total = this.roundToTwo(this.available) + this.roundToTwo(this.extra);\n    this.$totalGold.html(this.total.toString());\n    this.$remainingGold.html(this.roundToTwo(this.total - this.spent).toString());\n  }\n\n  roundToTwo(num: number) {\n    return Math.round(num * 100 + Number.EPSILON) / 100;\n  }\n\n  async setSourceData() {\n    const filteredItems = await getEquipmentEntries();\n    const itemBlackList = (Utils.getModuleSetting(SettingKeys.EQUIPMENTS_BLACKLIST) as string)\n      .split(';')\n      .map((e) => e.trim());\n    this.items = filteredItems\n      .filter((item) => item?.data?.rarity == 'common') // get only common items\n      .filter((item) => !itemBlackList.includes(item.name)); // remove some punctual \"common\" but magical/special items\n\n    this.defaultGoldDice = game.settings.get(Constants.MODULE_NAME, SettingKeys.DEFAULT_GOLD_DICE) as string;\n  }\n\n  async renderData() {\n    Utils.setPanelScrolls(this.section());\n    // Show rules on the side panel\n    const rulesCompendiumName = game.i18n.localize('HCT.Equipment.RulesJournalName');\n    const equipmentRules = await getRuleJournalEntryByName(rulesCompendiumName);\n    if (equipmentRules) {\n      $('[data-hct_equipment_description]', this.section()).html(TextEditor.enrichHTML(equipmentRules.content));\n    } else {\n      console.error(`Unable to find equipment's rule journal on compendium ${rulesCompendiumName}`);\n    }\n\n    this.searchableList = [...packs, ...this.items.filter((data) => data.name)];\n    this.$rollInput = $('[data-hct_equipment_roll_expression]', this.section()).val(this.defaultGoldDice);\n    this.$totalGold = $('[data-hct_total_gold]', this.section());\n    this.$remainingGold = $('[data-hct_remaining_gold]', this.section());\n    this.available = 0;\n    this.total = 0;\n    this.extra = 0;\n    this.spent = 0;\n  }\n\n  getOptions() {\n    // add remaining gold\n    const remaining = parseFloat(this.$remainingGold.html()) || 0;\n    const $addRemainingCheckbox = $('#hct-remaining-gold', this.section());\n    if ($addRemainingCheckbox.is(':checked') && remaining && remaining > 0) {\n      this.stepOptions.push(\n        new FixedOption(StepEnum.Equipment, 'data.currency', {\n          cp: Math.floor((remaining * 100) % 10),\n          sp: Math.floor((remaining * 10) % 10),\n          gp: Math.floor(remaining),\n        }),\n      );\n    }\n    return this.stepOptions;\n  }\n}\nconst EquipmentTab: Step = new _Equipment();\nexport default EquipmentTab;\n\nfunction isPack(item: EquipmentEntry): boolean {\n  return packs.includes(item);\n}\n\nconst enum PackNames {\n  BURGLAR = \"Burglar's Pack\",\n  DIPLOMAT = \"Diplomat's Pack\",\n  DUNGEONEER = \"Dungeoneer's Pack\",\n  ENTERTAINER = \"Entertainer's Pack\",\n  EXPLORER = \"Explorer's Pack\",\n  PRIEST = \"Priest's Pack\",\n  SCHOLAR = \"Scholar's Pack\",\n}\n\nconst PackPrices = {\n  BURGLAR: 16,\n  DIPLOMAT: 39,\n  DUNGEONEER: 12,\n  ENTERTAINER: 40,\n  EXPLORER: 10,\n  PRIEST: 19,\n  SCHOLAR: 40,\n};\nconst packs: EquipmentEntry[] = [\n  {\n    name: PackNames.BURGLAR,\n    data: { price: PackPrices.BURGLAR, rarity: '' },\n    img: 'icons/tools/hand/lockpicks-steel-grey.webp',\n    _id: '',\n    _pack: '',\n    type: '',\n  },\n  {\n    name: PackNames.DIPLOMAT,\n    data: { price: PackPrices.DIPLOMAT, rarity: '' },\n    img: 'icons/commodities/treasure/medal-ribbon-gold-red.webp',\n    _id: '',\n    _pack: '',\n    type: '',\n  },\n  {\n    name: PackNames.DUNGEONEER,\n    data: { price: PackPrices.DUNGEONEER, rarity: '' },\n    img: 'icons/sundries/lights/torch-brown-lit.webp',\n    _id: '',\n    _pack: '',\n    type: '',\n  },\n  {\n    name: PackNames.ENTERTAINER,\n    data: { price: PackPrices.ENTERTAINER, rarity: '' },\n    img: 'icons/tools/instruments/lute-gold-brown.webp',\n    _id: '',\n    _pack: '',\n    type: '',\n  },\n  {\n    name: PackNames.EXPLORER,\n    data: { price: PackPrices.EXPLORER, rarity: '' },\n    img: 'icons/tools/navigation/map-marked-green.webp',\n    _id: '',\n    _pack: '',\n    type: '',\n  },\n  {\n    name: PackNames.PRIEST,\n    data: { price: PackPrices.PRIEST, rarity: '' },\n    img: 'icons/commodities/treasure/token-gold-cross.webp',\n    _id: '',\n    _pack: '',\n    type: '',\n  },\n  {\n    name: PackNames.SCHOLAR,\n    data: { price: PackPrices.SCHOLAR, rarity: '' },\n    img: 'icons/skills/trades/academics-merchant-scribe.webp',\n    _id: '',\n    _pack: '',\n    type: '',\n  },\n];\n","import * as Utils from '../utils';\nimport { Step, StepEnum } from '../Step';\nimport FixedOption, { OptionType } from '../options/FixedOption';\nimport DeletableOption from '../options/DeletableOption';\nimport { getRuleJournalEntryByName, getSpellEntries, SpellEntry } from '../indexUtils';\nimport { ClassSpellcastingData as ClassSpellcastingData } from './classStep';\n\nclass _Spells extends Step {\n  constructor() {\n    super(StepEnum.Spells);\n  }\n\n  section = () => $('#spellsDiv');\n\n  $searchWrapper!: JQuery;\n  $inputBox!: JQuery;\n  $suggBox!: JQuery;\n  $itemList!: JQuery;\n  searchArray: SpellEntry[] = [];\n\n  spells: SpellEntry[] = [];\n  archived: SpellEntry[] = [];\n  rules?: string;\n\n  setListeners(): void {\n    this.$searchWrapper = $('.hct-search-wrapper', this.section());\n    this.$inputBox = $('input', this.$searchWrapper);\n    this.$suggBox = $('[data-hct-searchbar-results]', this.$searchWrapper);\n    this.$itemList = $('[data-hct-itemlist]', this.section());\n\n    $('[data-hct-searchbar]', this.section()).on('submit', (event) => {\n      if (this.searchArray.length == 1) {\n        try {\n          this.addItemToSelection(this.searchArray[0]);\n          this.$inputBox.val('');\n        } catch (error) {\n          console.error(error);\n          return false;\n        }\n      }\n      return false;\n    });\n\n    $('[data-hct_spells_clear]', this.section()).on('click', () => {\n      this.clearOptions();\n      this.$itemList.empty();\n      const deletedItems = this.archived.splice(0);\n      this.spells.push(...deletedItems);\n      $(`[data-hct_lv0_count]`, this.section()).html('0');\n      $(`[data-hct_lv1_count]`, this.section()).html('0');\n    });\n\n    this.$inputBox.on('keyup', (e) => {\n      const userData = (e.target as any).value;\n      if (userData) {\n        this.searchArray = this.spells.filter((data) => {\n          return (data as any).name\n            .toLocaleLowerCase()\n            .replaceAll(/\\s/g, '')\n            .includes(userData.toLocaleLowerCase().replaceAll(/\\s/g, ''));\n        });\n        this.$searchWrapper.addClass('active');\n        this.showSuggestions(this.searchArray);\n        $('div', this.$suggBox).on('click', (event) => {\n          this.select($(event.currentTarget).data('item_name'));\n        });\n      } else {\n        this.$searchWrapper.removeClass('active');\n      }\n    });\n  }\n\n  select(itemName: string) {\n    const item = this.spells.find((s) => s.name === itemName);\n    if (!item) ui.notifications?.error(game.i18n.localize('HCT.Spells.SelectItemError'));\n    this.addItemToSelection(item!);\n    this.$inputBox.val('');\n    this.$searchWrapper.removeClass('active');\n  }\n\n  addItemToSelection(item: SpellEntry) {\n    const itemOption = new DeletableOption(\n      StepEnum.Spells,\n      new FixedOption(StepEnum.Spells, 'items', item, undefined, {\n        addValues: true,\n        type: OptionType.ITEM,\n      }),\n      { addValues: true },\n      (id) => this.onDelete(item),\n      item,\n    );\n    itemOption.render(this.$itemList);\n    this.stepOptions.push(itemOption);\n\n    //remove spell from the available list\n    const removedItem = this.spells.splice(this.spells.indexOf(item), 1);\n    this.archived.push(...removedItem);\n\n    this.changeSpellCount((item.data as any).level, CountChange.UP);\n  }\n\n  onDelete(item: SpellEntry) {\n    const deletedItem = this.archived.splice(this.archived.indexOf(item), 1);\n    this.spells.push(...deletedItem);\n    $(`:contains(${item.name})`, this.$itemList).remove();\n    const optionToDelete = this.stepOptions.find((o) => {\n      const deletable = o as DeletableOption;\n      return deletable?.callbackParams === item;\n    });\n    if (optionToDelete) {\n      this.stepOptions.splice(this.stepOptions.indexOf(optionToDelete), 1);\n    }\n    this.changeSpellCount((item.data as any).level, CountChange.DOWN);\n  }\n\n  showSuggestions(list: SpellEntry[]) {\n    let listData;\n    if (!list.length) {\n      listData = `<li>${'No matches'}</li>`;\n    } else {\n      listData = list\n        .map(\n          (item: any) =>\n            `<li><div class=\"hct-icon-with-context\" data-item_name=\\\"${item.name}\\\"><img class=\"hct-icon-square-med hct-background-black hct-no-border\" src=\"${item.img}\"><span>${item.name}</span></div></li>`,\n        )\n        .join('');\n    }\n    this.$suggBox.html(listData);\n  }\n\n  async setSourceData() {\n    const spellIndexEntries = await getSpellEntries();\n    const maxLevel = 9;\n    this.spells = spellIndexEntries.filter((item) => item.data.level <= maxLevel);\n  }\n\n  changeSpellCount(spellLevel: number, change: CountChange) {\n    const current = Number.parseInt($(`[data-hct_lv${spellLevel}_count]`, this.section()).html());\n    const newVal = change === CountChange.UP ? current + 1 : current - 1;\n    $(`[data-hct_lv${spellLevel}_count]`, this.section()).html(newVal.toString());\n  }\n\n  async renderData() {\n    Utils.setPanelScrolls(this.section());\n    // Show rules on the side panel\n    const rulesCompendiumName = game.i18n.localize('HCT.Spells.RulesJournalName');\n    const spellsRules = await getRuleJournalEntryByName(rulesCompendiumName);\n    if (spellsRules) {\n      this.rules = TextEditor.enrichHTML(spellsRules.content);\n      $('[data-hct_spells_description]', this.section()).html(this.rules);\n    } else {\n      console.error(`Unable to find spells' rule journal on compendium ${rulesCompendiumName}`);\n    }\n\n    // for (let i = 0; i < 10; i++) {\n    //   $(`[data-hct_lv${i}_label]`, this.section()).html(`${(game as any).dnd5e.config.spellLevels[i]}: `);\n    // }\n  }\n\n  update(data: any) {\n    const $spellCastingAbilityElem = $('[data-hct_spellcasting_ability]', this.section());\n    const $showFeatureDescCheckbox = $(`#hct-show-class-spellcasting-desc`, this.section());\n    const $sidePanel = $('[data-hct_spells_description]', this.section());\n\n    if (data.class?.spellcasting) {\n      const classSpellcasting = data.class.spellcasting as ClassSpellcastingData;\n      const spa = (game as any).dnd5e.config.abilities[classSpellcasting.ability];\n\n      $spellCastingAbilityElem.html(\n        game.i18n.format('HCT.Spells.SpellcastingAbilityBlob', { class: data.class.name, spa: spa }),\n      );\n      const enrichedText = TextEditor.enrichHTML((classSpellcasting.item.data as any).data.description.value);\n      $showFeatureDescCheckbox.prop('disabled', false);\n      $showFeatureDescCheckbox.prev().css('color', '#191813');\n      $showFeatureDescCheckbox.on('change', (event) => {\n        $sidePanel.html((event.currentTarget as any).checked ? enrichedText : this.rules ?? '');\n      });\n      if ($showFeatureDescCheckbox.is(':checked')) {\n        $sidePanel.html(enrichedText);\n      }\n\n      //const maxSpellLevel = calculateMaxSpellLevel(data.class.level, data.class.spellcasting.progression);\n    } else {\n      $spellCastingAbilityElem.html(game.i18n.localize('HCT.Spells.NoSpellcastingClass'));\n      $sidePanel.html(this.rules ?? '');\n      $showFeatureDescCheckbox.prop('disabled', true);\n      $showFeatureDescCheckbox.prop('checked', false);\n      $showFeatureDescCheckbox.prev().css('color', 'darkgrey');\n    }\n  }\n}\nconst SpellsTab: Step = new _Spells();\nexport default SpellsTab;\n\nconst enum CountChange {\n  UP,\n  DOWN,\n}\n\n// function calculateMaxSpellLevel(level: number, progression: string): number | null {\n//   switch (progression) {\n//     case 'none':\n//       return null;\n//     case 'half':\n//       if (level > 1) return Math.floor(level / 2);\n//     case 'third':\n//       return (game as any).dnd5e.config.SPELL_SLOT_TABLE[level];\n//     case 'full':\n//       return (game as any).dnd5e.config.SPELL_SLOT_TABLE[level];\n//     default:\n//       return null;\n//   }\n// }\n","import FixedOption from '../options/FixedOption';\nimport HeroOption from '../options/HeroOption';\nimport { Step, StepEnum } from '../Step';\n\nclass _Bio extends Step {\n  constructor() {\n    super(StepEnum.Biography);\n  }\n\n  section = () => $('#bioDiv');\n\n  getOptions(): HeroOption[] {\n    const options: HeroOption[] = [];\n\n    $('[data-hct_bio_data]', this.section()).map((index, elem) => {\n      const $elem = $(elem);\n      options.push(\n        new FixedOption(StepEnum.Biography, `data.details.${$elem.data('hct_bio_data')}`, $elem.val() as string),\n      );\n    });\n    return options;\n  }\n}\nconst BioTab: Step = new _Bio();\nexport default BioTab;\n","/* Coco Liang\n version 0.1\n This object is a pop-up window to edit the actor's inital levels and stuffs\n */\nimport * as CONSTANTS from './constants';\nimport * as Utils from './utils';\nimport SettingKeys from './settings';\n\nimport BasicsTab from './tabs/basicsStep';\nimport AbilitiesTab from './tabs/abilitiesStep';\nimport RaceTab from './tabs/raceStep';\nimport ClassTab from './tabs/classStep';\nimport BackgroundTab from './tabs/backgroundStep';\nimport EquipmentTab from './tabs/equipmentStep';\nimport SpellsTab from './tabs/spellsStep';\nimport BioTab from './tabs/bioStep';\nimport { Step } from './Step';\nimport HeroOption from './options/HeroOption';\nimport type { ActorDataConstructorData } from '@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs/actorData';\nimport { HitDie } from './HitDie';\nimport { ClassLevel } from './ClassLevel';\nimport { hydrateItems, IndexEntry } from './indexUtils';\n\nenum StepIndex {\n  Basics,\n  Race,\n  Class,\n  Abilities,\n  Background,\n  Equipment,\n  Spells,\n  Bio,\n}\n\nexport default class HeroCreationTool extends Application {\n  actor?: Actor;\n  actorName?: string;\n  readonly steps: Array<Step>;\n  currentTab: StepIndex = StepIndex.Basics;\n\n  constructor() {\n    super();\n    this.actor = undefined;\n    this.steps = [BasicsTab, RaceTab, ClassTab, AbilitiesTab, BackgroundTab, EquipmentTab, SpellsTab, BioTab];\n  }\n\n  static get defaultOptions() {\n    const options = super.defaultOptions;\n    options.template = CONSTANTS.MODULE_PATH + '/templates/app.html';\n    options.width = 720;\n    options.height = 680;\n    options.resizable = true;\n    return options;\n  }\n\n  async openForNewActor(actorName?: string) {\n    this.actor = undefined;\n    this.actorName = actorName;\n    this.options.title = game.i18n.localize('HCT.CreationWindowTitle');\n    console.log(`${CONSTANTS.LOG_PREFIX} | Opening for new actor${actorName ? ' with name: ' + actorName : ''}`);\n    this.steps.forEach((step) => step.clearOptions());\n    this.currentTab = -1;\n    this.render(true);\n  }\n\n  // for level up\n  // async openForActor(actor: Actor) {\n  //   this.actor = actor;\n  //   this.options.title = game.i18n.localize('HCT.CreationWindowTitle');\n  //   console.log(`${CONSTANTS.LOG_PREFIX} | Opening for ${actor.name} (id ${actor.id})`);\n  //   this.steps.forEach(step => step.clearOptions());\n  //   this.currentTab = -1;\n  //   this.render(true);\n  // }\n\n  activateListeners() {\n    console.log(`${CONSTANTS.LOG_PREFIX} | Binding listeners`);\n\n    // listeners specific for each tab\n    for (const step of this.steps) {\n      step.setListeners();\n    }\n\n    // set listeners for tab navigation\n    $('[data-hct_tab_index]').on('click', (event) => {\n      this.currentTab = $(event.target).data('hct_tab_index');\n      this.openTab(this.currentTab);\n    });\n    $('[data-hct_back]').on('click', () => {\n      this.currentTab--;\n      this.openTab(this.currentTab);\n    });\n    $('[data-hct_next]').on('click', () => {\n      this.currentTab++;\n      this.openTab(this.currentTab);\n    });\n    $('[data-hct_submit]').on('click', () => this.confirmSubmittion());\n\n    this.openTab(-1);\n  }\n\n  async setupData() {\n    console.log(`${CONSTANTS.LOG_PREFIX} | Setting up data-derived elements`);\n    for (const step of this.steps) {\n      await step.setSourceData();\n    }\n  }\n\n  renderChildrenData() {\n    for (const step of this.steps) {\n      step.renderData({ actorName: this.actorName });\n    }\n  }\n\n  private async confirmSubmittion() {\n    new Dialog({\n      title: game.i18n.localize('HCT.Submit.Title'),\n      content: game.i18n.localize('HCT.Submit.Content'),\n      buttons: {\n        yes: {\n          icon: \"<i class='fas fa-check'></i>\",\n          label: game.i18n.localize('HCT.Submit.YesLabel'),\n          callback: () => {\n            this.buildActor();\n          },\n        },\n        no: {\n          icon: \"<i class='fas fa-times'></i>\",\n          label: game.i18n.localize('HCT.Submit.NoLabel'),\n        },\n      },\n      default: 'yes',\n    }).render(true);\n  }\n\n  private async buildActor() {\n    console.log(`${CONSTANTS.LOG_PREFIX} | Building actor - data used:`);\n    const newActorData = this.initializeActorData();\n    let errors = false;\n    // yeah, a loop label, sue me.\n    mainloop: for (const step of this.steps) {\n      for (const opt of step.getOptions()) {\n        if (this.requiredOptionNotFulfilled(opt)) {\n          errors = true;\n          break mainloop;\n        }\n        await opt.applyToHero(newActorData);\n      }\n    }\n    if (!errors) {\n      // calculate whatever needs inter-tab values like HP\n      cleanUpErroneousItems(newActorData);\n      await calculateStartingHp(newActorData, this.steps[StepIndex.Class].getUpdateData());\n      setTokenSettings(newActorData);\n      const itemsFromActor = newActorData.items; // moving item index entries to a different variable\n      newActorData.items = [];\n      const cls = getDocumentClass('Actor');\n      const actor = new cls(newActorData);\n\n      const newActor = await Actor.create(actor.toObject());\n      if (!newActor) {\n        ui.notifications?.error(game.i18n.format('HCT.Error.ActorCreationError', { name: newActorData?.name }));\n        return;\n      }\n      const itemsFromCompendia = await hydrateItems(itemsFromActor); // hydrating index entries for the actual items\n      setClassLevel(itemsFromCompendia, this.steps[StepIndex.Class].getUpdateData());\n      await newActor.createEmbeddedDocuments('Item', itemsFromCompendia as any); // adding items after actor creation to process active effects\n      this.close();\n    }\n  }\n\n  private initializeActorData() {\n    const newActor: ActorDataConstructorData & { items: IndexEntry[] } = {\n      name: '',\n      type: 'character',\n      sort: 12000,\n      img: CONSTANTS.MYSTERY_MAN,\n      token: {\n        actorLink: true,\n        disposition: 1,\n        img: CONSTANTS.MYSTERY_MAN,\n        vision: true,\n        dimSight: 0,\n        bar1: { attribute: 'attributes.hp' },\n        displayBars: 0,\n        displayName: 0,\n      },\n      items: [],\n    };\n    return newActor;\n  }\n\n  private requiredOptionNotFulfilled(opt: HeroOption): boolean {\n    const key = opt.key;\n    if (key === 'name' && !opt.isFulfilled()) {\n      const errorMessage = game.i18n.format('HCT.Error.RequiredOptionNotFulfilled', { opt: opt.key });\n      ui.notifications?.error(errorMessage);\n      return true;\n    }\n    return false;\n  }\n\n  openTab(index: StepIndex): void {\n    handleNavs(index);\n    $('.tab-body').hide();\n    $('.tablinks').removeClass('active');\n    $(`[data-hct_tab_index=${index}]`).addClass('active');\n    $(`[data-hct_tab_section=${index}]`).show();\n    switch (index) {\n      case StepIndex.Spells:\n        this.steps[StepIndex.Spells].update({ class: this.steps[StepIndex.Class].getUpdateData() });\n        break;\n      case StepIndex.Abilities:\n        this.steps[StepIndex.Abilities].update();\n        break;\n    }\n  }\n}\n\nasync function calculateStartingHp(newActor: ActorDataConstructorData, classUpdateData: any) {\n  const totalCon = getProperty(newActor, 'data.abilities.con.value');\n  const conModifier: number = totalCon ? Utils.getAbilityModifierValue(totalCon) : 0;\n  if (!classUpdateData) return 10 + conModifier; // release valve in case there's no class selected\n\n  const hitDie: HitDie = classUpdateData?.hitDie;\n  const startingLevel: ClassLevel = classUpdateData?.level;\n  const method: CONSTANTS.HpCalculation = classUpdateData?.hpMethod;\n\n  const startingHp = await hitDie.calculateHpAtLevel(startingLevel, method, conModifier);\n  setProperty(newActor, 'data.attributes.hp.max', startingHp);\n  setProperty(newActor, 'data.attributes.hp.value', startingHp);\n}\n\nfunction setTokenSettings(newActor: ActorDataConstructorData) {\n  const displayBarsSetting = game.settings.get(CONSTANTS.MODULE_NAME, SettingKeys.TOKEN_BAR);\n  setProperty(newActor, 'token.displayBars', displayBarsSetting);\n\n  const displayNameSetting = game.settings.get(CONSTANTS.MODULE_NAME, SettingKeys.TOKEN_NAME);\n  setProperty(newActor, 'token.displayName', displayNameSetting);\n\n  const dimSight = (newActor?.data as any)?.attributes?.senses.darkvision ?? 0;\n  setProperty(newActor, 'token.dimSight', dimSight);\n}\n\nfunction cleanUpErroneousItems(newActor: ActorDataConstructorData) {\n  let items = getProperty(newActor, 'items');\n  items = items?.filter(Boolean); // filter undefined items\n  if (items) setProperty(newActor, 'items', items);\n  else delete newActor.items;\n}\n\nfunction handleNavs(index: number) {\n  // hides the tabs if switching to startDiv, else show them.\n  $('.hct-container .tabs').toggle(index !== -1);\n\n  // disables back/next buttons where appropriate\n  const $footer = $('.hct-container footer');\n  $('[data-hct_back]', $footer).prop('disabled', index < StepIndex.Basics);\n  $('[data-hct_next]', $footer).prop('disabled', index >= StepIndex.Bio);\n}\n\nfunction setClassLevel(itemsFromCompendia: Item[], classData: any) {\n  const classItem = itemsFromCompendia.find((i) => i.type === 'class');\n  if (classItem) {\n    (classItem as any).data.levels = classData.level;\n  }\n}\n","import { DEFAULT_PACKS, MODULE_NAME } from '../constants';\nimport SettingKeys from '../settings';\n\nexport default () => {\n  ui.notifications?.info(game.i18n.format('HCT.Migrations.Info1'));\n\n  game.settings.set(MODULE_NAME, SettingKeys.SOURCES, {\n    races: [DEFAULT_PACKS.RACES],\n    racialFeatures: [DEFAULT_PACKS.RACE_FEATURES],\n    classes: [DEFAULT_PACKS.CLASSES],\n    classFeatures: [DEFAULT_PACKS.CLASS_FEATURES],\n    backgroundFeatures: [],\n    spells: [DEFAULT_PACKS.SPELLS],\n    feats: [],\n  });\n};\n","import { MODULE_NAME } from '../constants';\nimport { PrivateSettingKeys } from '../settings';\nimport { getModuleSetting } from '../utils';\nimport migration1 from './migration_1';\n\nexport default async function performMigrations() {\n  const lastMigration = getModuleSetting(PrivateSettingKeys.LAST_MIGRATION) as number;\n\n  const allMigrations = [migration1];\n\n  const migrationsToRun = allMigrations.slice(lastMigration);\n\n  for (let i = 0; i < migrationsToRun.length; i++) {\n    await migrationsToRun[i]();\n    await game.settings.set(\n      MODULE_NAME,\n      PrivateSettingKeys.LAST_MIGRATION,\n      allMigrations.indexOf(migrationsToRun[i]) + 1,\n    );\n  }\n}\n","import SettingKeys, { registerSettings } from './settings';\nimport { preloadTemplates } from './preloadTemplates';\nimport HeroCreationTool from './HeroCreationToolApp';\nimport { buildEquipmentAndJournalIndexes, buildSourceIndexes } from './indexUtils';\nimport { addActorDirectoryButton, addCreateNewActorButton, getModuleSetting } from './utils';\nimport performMigrations from './migrations/migrationsHandler';\n\nconst heroCreationTool = new HeroCreationTool();\n\n// Initialize module\nHooks.once('init', async () => {\n  registerSettings();\n  await preloadTemplates();\n});\n\n// Build indexes on ready\nHooks.once('ready', async () => {\n  await buildEquipmentAndJournalIndexes();\n  await performMigrations();\n});\n\nHooks.on('renderHeroCreationTool', async function (app: any, html: any, data: any) {\n  await buildSourceIndexes();\n  await heroCreationTool.setupData();\n  heroCreationTool.renderChildrenData();\n});\n\n// Rendering the button on Actor's directory\nHooks.on('renderActorDirectory', () => {\n  if (!getModuleSetting(SettingKeys.BUTTON_ON_DIALOG)) {\n    addActorDirectoryButton(heroCreationTool);\n  }\n});\n\n// Rendering the button on the Create New Actor dialog\nHooks.on('renderApplication', (app: any, html: any, data: any) => {\n  if (app.title === 'Create New Actor' && getModuleSetting(SettingKeys.BUTTON_ON_DIALOG)) {\n    addCreateNewActorButton(heroCreationTool, html, app);\n  }\n});\n\n// This hooks onto the rendering actor sheet to show the button\n// Hooks.on('renderActorSheet5eCharacter', (app: any, html: HTMLElement, data: any) => {\n//   const $experienceDiv = document.getElementsByClassName('experience')[0];\n//   const $currentExpInput = $experienceDiv.querySelector('[name=\"data.details.xp.value\"]')!;\n//   const maxExp = parseInt(($experienceDiv.querySelector('.max') as HTMLSpanElement).innerText ?? '0');\n//   const currentExp = parseInt(($currentExpInput as HTMLInputElement).value) ?? 0;\n\n//   if (currentExp >= maxExp) {\n//     const $levelUpButton = document.createElement('button');\n//     $levelUpButton.id = 'hct-level-up';\n//     $levelUpButton.setAttribute('type', 'button');\n//     $levelUpButton.style.display = 'block';\n//     $levelUpButton.appendChild(document.createTextNode(game.i18n.localize('HCT.ActorLevelUpButton')));\n//     $levelUpButton.addEventListener('click', async () => {\n//       const actor = game.actors?.get(data.actor._id);\n//       if (!actor) throw new Error(`Unable to find actor for id ${data.actor._id}`);\n//       heroCreationTool.openForActor(actor);\n//       app.close();\n//     });\n\n//     $currentExpInput.before($levelUpButton);\n//   }\n// });\n"],"names":["Constants.MODULE_NAME","Constants.LOG_PREFIX","Constants.MODULE_PATH","Constants.INTEGRATION","Constants.MYSTERY_MAN","CONSTANTS.LOG_PREFIX","CONSTANTS.MODULE_NAME","Utils.getModuleSetting","Utils.setPanelScrolls","ProficiencyUtils.prepareSkillOptions","ProficiencyUtils.prepareWeaponOptions","ProficiencyUtils.prepareArmorOptions","ProficiencyUtils.prepareToolOptions","ProficiencyUtils.prepareLanguageOptions","Utils.filterItemList","CONSTANTS.MYSTERY_MAN","CONSTANTS.MODULE_PATH","Utils.getAbilityModifierValue"],"mappings":"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"}